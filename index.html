
<Body html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Treasure Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        /* style.css */
        /* Global Styles */
        :root {
            --primary-color: #6a1b9a; /* Deep Purple */
            --primary-light: #9c4dcc;
            --primary-dark: #38006b;
            --secondary-color: #26a69a; /* Teal */
            --secondary-light: #64d8cb;
            --secondary-dark: #00766c;
            --accent-color: #ff7043; /* Orange */
            --accent-light: #ffa270;
            --accent-dark: #c63f17;
            --success-color: #4caf50; /* Green */
            --warning-color: #ff9800; /* Amber */
            --danger-color: #f44336; /* Red */
            --info-color: #2196f3; /* Blue */
            --light-color: #f5f5f5;
            --light-text: #ffffff;
            --dark-text: #212121;
            --gray-text: #757575;
            --light-gray: #e0e0e0;
            --medium-gray: #bdbdbd;
            --dark-gray: #616161;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 8px 16px rgba(0, 0, 0, 0.15);
            --border-radius: 10px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f9f9f9;
            color: var(--dark-text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .hidden {
            display: none !important;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-dark);
        }

        p {
            margin-bottom: 15px;
            color: var(--gray-text);
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: var(--transition);
        }

        a:hover {
            color: var(--primary-light);
        }

        /* Auth Styles */
        #auth-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: var(--light-text);
            padding: 20px;
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
            text-align: center;
        }

        .logo {
            width: 100px;
            height: 100px;
            margin-bottom: 15px;
            animation: pulse 2s infinite;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .app-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            color: var(--light-text);
        }

        #auth-options {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            width: 100%;
            max-width: 400px;
        }

        .auth-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            background-color: var(--accent-color);
            color: var(--light-text);
            box-shadow: var(--shadow);
            flex: 1;
            text-align: center;
        }

        .auth-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
            background-color: var(--accent-light);
        }

        .auth-form {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 400px;
            box-shadow: var(--shadow-hover);
            animation: fadeIn 0.5s ease;
            color: var(--dark-text);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-form h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8rem;
        }

        .form-group {
            position: relative;
            margin-bottom: 20px;
        }

        .form-group i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-text);
        }
        
        .form-group.password-container i.fas.fa-lock { /* Specific for lock icon */
             left: 15px;
        }

        .password-container .password-toggle i { /* Specific for eye icon */
            left: auto;
            right: 15px;
        }


        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-text);
            cursor: pointer;
        }

        .password-strength {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 5px;
        }

        .strength-bar {
            height: 4px;
            flex: 1;
            background-color: var(--light-gray);
            border-radius: 2px;
            /* overflow: hidden; */ /* Removed to allow individual bar styling */
        }
        /* Individual strength bars for color */
        .strength-bar.weak { background-color: var(--danger-color); }
        .strength-bar.medium { background-color: var(--warning-color); }
        .strength-bar.strong { background-color: var(--success-color); }


        .strength-text {
            font-size: 0.8rem;
            color: var(--gray-text);
            margin-left: 5px;
        }

        .auth-form input {
            width: 100%;
            padding: 12px 15px 12px 40px; /* Increased left padding for icon */
            margin-bottom: 5px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: #fafafa;
        }

        .password-container input {
            padding-right: 45px; /* Space for password toggle */
        }
        
        .password-container.has-strength input { /* If strength meter is present */
            padding-right: 70px; /* More space if strength meter is also there */
        }


        .auth-form input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(106, 27, 154, 0.2);
            background-color: var(--card-bg);
        }

        .terms {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }

        .terms input {
            width: auto;
            margin-right: 10px;
        }

        .terms label {
            font-size: 0.9rem;
            color: var(--gray-text);
        }

        #terms-link {
            color: var(--primary-color);
            font-weight: 500;
        }

        .submit-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: var(--light-text);
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .submit-btn:hover {
            background-color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .btn-text, .btn-loader {
            display: inline-block;
        }

        .auth-switch {
            text-align: center;
            margin-top: 20px;
            color: var(--gray-text);
            font-size: 0.9rem;
        }

        .auth-switch span {
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 600;
        }

        .forgot-password {
            text-align: center;
            margin: 15px 0;
            color: var(--accent-color);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
        }

        #email-verify-notice {
            text-align: center;
        }

        .verify-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        #verify-email {
            font-weight: 600;
            color: var(--primary-color);
        }

        #resend-verify {
            color: var(--primary-color);
            font-weight: 600;
            cursor: pointer;
            text-decoration: underline;
        }

        /* App Styles */
        #app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f5f5f5;
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--primary-color);
            color: var(--light-text);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .menu-toggle {
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--light-text);
            transition: var(--transition);
        }

        .menu-toggle:hover {
            transform: scale(1.1);
        }

        .app-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .app-logo img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
        }

        .app-logo h1 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--light-text);
            margin-bottom: 0; /* Override general h1 margin */
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .balance-container {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
        }

        #user-balance {
            font-weight: 600;
        }

        .refresh-balance {
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .refresh-balance:hover {
            transform: rotate(180deg);
        }

        .user-avatar {
            position: relative;
            cursor: pointer;
        }

        .user-avatar i {
            font-size: 1.8rem;
            color: var(--light-text);
        }

        .online-status {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 10px;
            height: 10px;
            background-color: var(--success-color);
            border-radius: 50%;
            border: 2px solid var(--primary-color);
        }

        .side-menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100vh;
            background-color: var(--card-bg);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            z-index: 1000;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .side-menu.active {
            left: 0;
        }

        .menu-header {
            padding: 20px;
            background-color: var(--primary-color);
            color: var(--light-text);
            text-align: center;
            position: relative;
        }

        .menu-header img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 10px;
            border: 3px solid var(--light-text);
            object-fit: cover;
        }

        .menu-header h3 {
            color: var(--light-text);
            margin-bottom: 5px;
        }

        .menu-header span {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .user-level {
            margin-top: 10px;
        }

        #user-level-badge {
            display: inline-block;
            background-color: var(--accent-color);
            color: var(--light-text);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .menu-items {
            list-style: none;
            padding: 10px 0;
            flex: 1;
        }

        .menu-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
            color: var(--gray-text);
        }

        .menu-item span {
            flex: 1;
        }

        .menu-item i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .menu-item:hover {
            background-color: var(--light-color);
            color: var(--primary-color);
        }

        .menu-item.active {
            background-color: var(--light-color);
            border-left: 4px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: 500;
        }

        .menu-footer {
            padding: 15px;
            text-align: center;
            font-size: 0.8rem;
            color: var(--gray-text);
            border-top: 1px solid var(--light-gray);
        }

        .main-content {
            flex: 1;
            padding: 20px;
            margin-top: 60px; /* Height of app-header */
            transition: var(--transition);
        }
        
        @media (max-width: 768px) {
            .main-content {
                margin-left: 0; /* Reset margin when menu is not permanently open */
            }
            .side-menu.active + .main-content {
                /* Add blur or dim effect if needed when menu is open on mobile */
            }
        }

        /* Page Styles */
        .page {
            animation: fadeIn 0.5s ease;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-header {
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .page-header h2 {
            margin-bottom: 0;
        }

        .page-description {
            color: var(--gray-text);
            margin-bottom: 20px;
            width: 100%;
        }

        /* Home Page */
        .slideshow-container {
            position: relative;
            max-width: 100%;
            margin: auto;
            overflow: hidden;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .slide {
            display: none;
            position: relative;
        }

        .slide img {
            width: 100%;
            vertical-align: middle;
            height: 300px; /* Fixed height for slides */
            object-fit: cover; /* Ensure image covers the area */
        }

        .slide-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            color: var(--light-text);
            padding: 30px 20px 20px;
        }

        .slide-content h3 {
            color: var(--light-text);
            margin-bottom: 5px;
        }

        .slide-content p {
            color: rgba(255,255,255,0.8);
            margin-bottom: 0;
        }

        .prev, .next {
            cursor: pointer;
            position: absolute;
            top: 50%;
            width: auto;
            padding: 16px;
            margin-top: -22px;
            color: white;
            font-weight: bold;
            font-size: 18px;
            transition: 0.6s ease;
            border-radius: 0 3px 3px 0;
            user-select: none;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .next {
            right: 0;
            border-radius: 3px 0 0 3px;
        }

        .prev:hover, .next:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }

        .dot-container { /* Used for styling the dot container below slideshow */
            text-align: center;
            padding: 10px 0;
        }

        .dot {
            cursor: pointer;
            height: 12px;
            width: 12px;
            margin: 0 5px;
            background-color: var(--light-gray);
            border-radius: 50%;
            display: inline-block;
            transition: background-color 0.6s ease;
        }

        .active-dot, .dot:hover {
            background-color: var(--primary-color);
        }
        .fade {
            animation-name: fade;
            animation-duration: 1.5s;
        }
        @keyframes fade {
            from {opacity: .4}
            to {opacity: 1}
        }


        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .stat-card.large {
            grid-column: span 2; /* For wider stat cards if needed */
        }

        .stat-icon { /* Common class for icons in stat cards and referral stats */
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        .referral-stat .stat-icon { /* Specific for referral stats if different size needed */
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
            background-color: rgba(106, 27, 154, 0.1); /* Lighter primary */
        }


        .stat-card h3 {
            font-size: 1rem;
            color: var(--gray-text);
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0;
        }

        .quick-actions {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        .quick-action {
            flex: 1 1 150px; /* Flex grow, shrink, basis */
            min-width: 150px; /* Minimum width before wrapping */
            background-color: var(--card-bg);
            border: none;
            border-radius: var(--border-radius);
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            color: var(--gray-text);
            text-align: center;
        }

        .quick-action i {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .quick-action span {
            font-weight: 500;
        }

        .quick-action:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
            background-color: var(--primary-color);
            color: var(--light-text);
        }

        .quick-action:hover i {
            color: var(--light-text);
        }

        .announcement-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-top: 30px;
        }

        .announcement-card h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .announcement-card h3 i { /* Specific for announcement icon */
            color: var(--accent-color);
        }

        .announcement-content {
            padding: 10px;
            background-color: var(--light-color);
            border-radius: 5px;
        }

        /* Team Page */
        .ranking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .rank-badge {
            background-color: var(--accent-color);
            color: var(--light-text);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rank-badge i {
            font-size: 1.2rem;
        }

        .action-btn {
            background-color: var(--primary-color);
            color: var(--light-text);
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            background-color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .ranking-table { /* Container for the table */
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }

        th {
            background-color: var(--light-color);
            color: var(--primary-color);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
        }

        tr:hover {
            background-color: var(--light-color);
        }

        .current-user { /* Highlight for current user row in tables */
            background-color: rgba(106, 27, 154, 0.1) !important; /* Ensure it overrides hover */
            font-weight: 500;
        }

        .invitation-section {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .invitation-section h3 {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .invite-code-container {
            display: flex;
            margin: 15px 0;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 0 0 1px var(--light-gray);
        }

        #invite-code {
            flex: 1;
            padding: 12px 15px;
            border: none;
            font-weight: 600;
            color: var(--primary-color);
            background-color: #fafafa;
        }

        .copy-btn {
            padding: 12px 20px;
            background-color: var(--primary-color);
            color: var(--light-text);
            border: none;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .copy-btn:hover {
            background-color: var(--primary-light);
        }

        .invite-note {
            font-style: italic;
            color: var(--gray-text);
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .referral-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .referral-stat {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .referral-stat h4 {
            font-size: 0.9rem;
            color: var(--gray-text);
            margin-bottom: 5px;
        }

        .referral-stat p {
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0;
            font-size: 1.1rem;
        }

        .referral-share {
            margin: 25px 0;
        }

        .referral-share h4 {
            margin-bottom: 15px;
            color: var(--gray-text);
            font-size: 1rem;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .share-btn {
            padding: 10px 15px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .share-btn i {
            font-size: 1.1rem;
        }

        .share-btn.whatsapp {
            background-color: #25D366;
            color: white;
        }

        .share-btn.facebook {
            background-color: #3b5998;
            color: white;
        }

        .share-btn.copy-link {
            background-color: var(--light-color);
            color: var(--dark-text);
            border: 1px solid var(--light-gray);
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
            opacity: 0.9;
        }

        .referral-table th, .referral-table td {
            padding: 10px 15px;
            font-size: 0.9rem;
        }

        .status-pending {
            color: var(--warning-color);
            font-weight: 600;
        }

        .status-completed {
            color: var(--success-color);
            font-weight: 600;
        }

        .status-rejected, .status-cancelled {
            color: var(--danger-color);
            font-weight: 600;
        }

        /* Plans Page */
        .plans-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .plan-card {
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            position: relative;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .plan-card h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.3rem;
        }

        .plan-price {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-color);
            text-align: center;
            margin-bottom: 15px;
        }

        .plan-duration {
            text-align: center;
            color: var(--gray-text);
            font-size: 0.9rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .plan-features {
            list-style: none;
            margin-bottom: 25px;
            flex: 1; /* Allows button to stick to bottom */
        }

        .plan-features li {
            margin-bottom: 10px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 0.95rem;
            color: var(--gray-text);
        }

        .plan-features i {
            color: var(--success-color);
            margin-top: 3px;
        }

        .buy-plan-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: var(--light-text);
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: auto; /* Pushes button to bottom if plan-features is flex:1 */
        }

        .buy-plan-btn:hover {
            background-color: var(--primary-light);
        }

        .popular {
            border: 2px solid var(--accent-color);
        }

        .popular-badge {
            position: absolute;
            top: -10px;
            right: 20px;
            background-color: var(--accent-color);
            color: var(--light-text);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: var(--shadow);
        }

        .plan-info-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-top: 30px;
        }

        .plan-info-card h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .plan-info-card h3 i { /* Specific for info icon */
            color: var(--info-color);
        }

        .info-content {
            padding: 10px;
            background-color: var(--light-color);
            border-radius: 5px;
        }

        .info-content p {
            margin-bottom: 10px;
            display: flex; /* For aligning strong and text */
        }

        .info-content p strong {
            min-width: 120px; /* Ensure consistent label width */
            color: var(--dark-text);
            margin-right: 5px;
        }

        /* Deposit Page */
        .deposit-methods {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .method-card {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column; /* Stack image and text */
            align-items: center;
            gap: 10px;
            border: 2px solid transparent;
            min-width: 150px; /* Minimum width for method cards for crypto names */
            text-align: center;
        }

        .method-card img {
            height: 40px; /* Adjusted height */
            width: auto;
            max-width: 100px; /* Max width for logo */
            object-fit: contain;
        }

        .method-card.active {
            border-color: var(--primary-color);
            background-color: rgba(106, 27, 154, 0.05);
        }

        .method-card:hover:not(.active) {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .deposit-instructions {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .deposit-instructions h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .deposit-instructions h3 i {
            color: var(--info-color);
        }

        .deposit-instructions p {
            margin-bottom: 15px;
        }

        .account-details {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .detail-item {
            display: flex;
            margin-bottom: 10px;
            align-items: center; /* Align items vertically in the flex container */
            flex-wrap: wrap; /* Allow wrapping on small screens */
        }
        .detail-item:last-child {
            margin-bottom: 0;
        }

        .detail-label {
            font-weight: 600;
            min-width: 180px; /* Adjusted width for longer labels */
            color: var(--dark-text);
            margin-bottom: 5px; /* Spacing on wrap */
            margin-right: 10px;
        }

        .detail-value-container {
            display: flex;
            align-items: center;
            flex: 1;
            min-width: 200px; /* Ensure space for address and button */
        }

        .detail-value {
            flex-grow: 1;
            font-family: monospace, 'Courier New', Courier; /* Monospace for numbers */
            font-size: 1rem; /* Adjusted for long addresses */
            color: var(--primary-color);
            word-break: break-all; /* Prevent overflow */
        }

        .copy-address-btn {
            background-color: var(--secondary-color);
            color: var(--light-text);
            border: none;
            padding: 6px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            margin-left: 10px;
            flex-shrink: 0; /* Prevent button from shrinking */
        }
        .copy-address-btn:hover {
            background-color: var(--secondary-dark);
        }


        .important-note {
            display: flex;
            gap: 10px;
            background-color: #fff8e1; /* Light yellow for notes */
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            border-left: 4px solid var(--warning-color);
        }

        .important-note i {
            color: var(--warning-color);
            font-size: 1.2rem;
            margin-top: 2px;
        }

        .important-note p {
            margin-bottom: 0;
            color: var(--dark-text);
        }

        .deposit-form {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .deposit-form h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .deposit-form h3 i {
            color: var(--primary-color);
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-text);
        }

        .form-select { /* General select style */
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 15px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 1rem;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 1em;
            transition: var(--transition);
            background-color: var(--card-bg); /* Ensure background color for select */
        }

        .form-select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(106, 27, 154, 0.2);
        }

        #custom-amount-container {
            margin-top: 10px;
        }

        #custom-amount { /* Input for custom amount */
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        /* Withdraw Page */
        .withdraw-info-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            background-color: var(--light-color);
            border-radius: 8px;
        }

        .info-item i {
            font-size: 1.5rem;
            color: var(--primary-color);
            flex-shrink: 0; /* Prevent icon from shrinking */
        }

        .info-content h4 {
            font-size: 0.9rem;
            color: var(--gray-text);
            margin-bottom: 5px;
        }

        .info-content p {
            font-weight: 500;
            color: var(--dark-text);
            margin-bottom: 0;
        }

        .withdraw-form {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .withdraw-form h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .withdraw-form h3 i {
            color: var(--primary-color);
        }

        .amount-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .amount-btn {
            padding: 8px 12px; /* Slightly smaller padding */
            background-color: var(--light-color);
            border: 1px solid var(--light-gray);
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            color: var(--primary-color);
        }

        .amount-btn:hover {
            background-color: var(--primary-color);
            color: var(--light-text);
            border-color: var(--primary-color);
        }

        /* History Pages */
        .history-filter {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px; /* Add margin if it's inside page-header or separate */
        }

        .history-filter select {
            padding: 8px 12px;
            border: 1px solid var(--light-gray);
            border-radius: 5px;
            background-color: var(--card-bg);
            min-width: 150px; /* Give select some base width */
        }

        .history-table { /* This refers to the <table> element itself */
            width: 100%;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            overflow: hidden; /* For rounded corners on table */
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            border-collapse: collapse; /* Important for styling */
        }

        .history-table th { /* Overriding general th for history tables */
            background-color: var(--primary-color);
            color: var(--light-text);
            text-align: left;
        }
        .history-table td {
            text-align: left;
        }

        .history-table tr:nth-child(even) {
            background-color: var(--light-color);
        }
        .history-table tr:hover {
            background-color: #e9e0f1; /* Light purple hover for history tables */
        }


        .history-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .summary-card {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
        }

        .summary-card h4 {
            color: var(--gray-text);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .summary-card p {
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0;
            font-size: 1.2rem;
        }

        .action-link {
            color: var(--primary-color);
            font-weight: 500;
            cursor: pointer;
            text-decoration: underline;
        }

        .action-link:hover {
            color: var(--primary-dark);
        }
        td .action-link { /* Specific styling for links in table cells */
            font-size: 0.9em;
        }


        /* Earnings Page */
        .earnings-stats { /* Similar to .stats-container */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .earnings-filter {
             margin-bottom: 15px;
        }
        .earnings-filter select {
            padding: 8px 12px;
            border: 1px solid var(--light-gray);
            border-radius: 5px;
            background-color: var(--card-bg);
            min-width: 150px;
        }


        .earnings-chart-container {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .earnings-chart-container h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .earnings-chart-container h3 i {
            color: var(--primary-color);
        }

        #earnings-chart {
            width: 100% !important; /* Ensure chart takes full width */
            max-height: 350px; /* Max height for the chart */
        }

        .earnings-table-container {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .earnings-table-container h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .earnings-table-container h3 i {
            color: var(--primary-color);
        }

        .earnings-table th, .earnings-table td { /* Specific to earnings table */
            padding: 10px 15px;
            font-size: 0.9rem;
        }

        /* Contact Page */
        .contact-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .contact-card {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .contact-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .contact-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 1.8rem; /* Increased icon size */
        }

        .contact-card.whatsapp .contact-icon {
            color: #25D366;
        }

        .contact-card.email .contact-icon {
            color: var(--primary-color);
        }

        .contact-card.phone .contact-icon {
            color: var(--info-color);
        }

        .contact-card h3 {
            margin-bottom: 10px;
            font-size: 1.2rem; /* Slightly larger heading */
        }

        .contact-card p {
            margin-bottom: 20px;
            flex: 1; /* Helps align buttons if content varies */
            color: var(--gray-text);
        }

        .contact-btn {
            display: inline-block;
            padding: 10px 25px; /* Increased padding */
            background-color: var(--primary-color);
            color: var(--light-text);
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
            margin-top: auto; /* Push button to bottom */
        }

        .contact-btn:hover {
            background-color: var(--primary-light);
            color: var(--light-text); /* Ensure text color stays light on hover */
        }

        .contact-form-container {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .contact-form-container h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .contact-form-container h3 i {
            color: var(--primary-color);
        }

        #contact-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-text);
        }

        #contact-form input,
        #contact-form textarea {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 15px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: #fafafa;
        }

        #contact-form textarea {
            resize: vertical;
            min-height: 120px;
        }

        #contact-form input:focus,
        #contact-form textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(106, 27, 154, 0.2);
            background-color: var(--card-bg);
        }

        /* Loading Overlay */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8); /* Lighter overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            transition: opacity 0.3s ease;
        }

        .loader-content {
            background-color: var(--card-bg);
            padding: 30px 40px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--shadow-hover);
            color: var(--dark-text);
        }

        .loader-content i {
            font-size: 2.5rem; /* Larger spinner */
            color: var(--primary-color);
            margin-bottom: 15px;
            display: block; /* Make spinner block for centering */
        }

        .loader-content p {
            font-weight: 500;
            color: var(--dark-text);
            margin-bottom: 0;
            font-size: 1.1rem;
        }

        /* Notification System */
        #notification-container {
            position: fixed;
            top: 80px; /* Below header */
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: calc(100% - 40px); /* Max width with padding */
            max-width: 380px; /* Max width for notifications */
        }

        .notification {
            padding: 15px 20px;
            border-radius: var(--border-radius);
            color: var(--light-text);
            box-shadow: var(--shadow-hover);
            animation: slideInRight 0.4s ease-out, fadeOut 0.5s ease-in 3.5s forwards;
            display: flex;
            align-items: center;
            gap: 15px; /* Increased gap */
            font-size: 0.95rem;
            line-height: 1.4;
        }

        @keyframes slideInRight {
            from { transform: translateX(120%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.9); }
        }

        .notification i {
            font-size: 1.3rem; /* Larger icon */
            flex-shrink: 0;
        }

        .notification.success { background-color: var(--success-color); }
        .notification.error { background-color: var(--danger-color); }
        .notification.warning { background-color: var(--warning-color); color: var(--dark-text); } /* Dark text for yellow */
        .notification.info { background-color: var(--info-color); }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* Darker backdrop */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1500;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            padding: 20px; /* Padding for smaller screens */
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            width: 100%; /* Full width on small screens */
            max-width: 450px; /* Max width for modals */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            transform: translateY(20px) scale(0.95);
            transition: transform 0.3s ease, opacity 0.3s ease;
            position: relative;
            opacity: 0;
        }

        .modal.active .modal-content {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .modal-icon {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-icon i {
            font-size: 3.5rem; /* Larger modal icon */
            display: none; /* Hide all by default */
        }

        .modal-icon i.success { display: block; color: var(--success-color); }
        .modal-icon i.warning { display: block; color: var(--warning-color); }
        .modal-icon i.error { display: block; color: var(--danger-color); }

        .modal h3 {
            text-align: center;
            margin-bottom: 15px;
            color: var(--primary-dark); /* Darker title for modal */
            font-size: 1.4rem;
        }

        .modal p {
            text-align: center;
            margin-bottom: 25px;
            color: var(--gray-text);
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end; /* Align buttons to right */
            gap: 15px; /* Increased gap */
            margin-top: 10px; /* Space above buttons */
        }

        .modal-btn {
            padding: 10px 25px; /* Larger buttons */
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            min-width: 120px; /* Minimum width */
            font-size: 0.95rem;
        }

        .modal-btn.cancel {
            background-color: var(--light-gray);
            color: var(--dark-text);
            border: 1px solid var(--medium-gray);
        }

        .modal-btn.cancel:hover {
            background-color: var(--medium-gray);
        }

        .modal-btn.confirm {
            background-color: var(--primary-color);
            color: var(--light-text);
        }
        .modal-btn.confirm.error { background-color: var(--danger-color); } /* For error confirmation */
        .modal-btn.confirm.warning { background-color: var(--warning-color); color: var(--dark-text); }


        .modal-btn.confirm:hover {
            background-color: var(--primary-light);
        }
        .modal-btn.confirm.error:hover { background-color: var(--accent-dark); }
        .modal-btn.confirm.warning:hover { background-color: var(--accent-light); }


        .terms-content {
            max-height: 80vh;
            overflow-y: auto;
        }

        .terms-text {
            margin-bottom: 20px;
            font-size: 0.9rem;
            line-height: 1.7;
        }

        .terms-text h4 {
            margin-top: 20px;
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        .terms-content #terms-accept.submit-btn {
             width: auto; /* Fit content */
             margin: 20px auto 0; /* Center button */
             display: block;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .stat-card.large {
                grid-column: span 1; /* Stack large cards on smaller screens */
            }
        }


        @media (max-width: 768px) {
            .stats-container, .referral-stats, .earnings-stats {
                grid-template-columns: 1fr;
            }
            
            .app-title {
                font-size: 2rem;
            }
            
            .auth-form {
                padding: 25px; /* Slightly more padding */
            }
            
            .side-menu {
                width: 260px; /* Slightly wider for touch */
                left: -270px; /* Adjust for slight visual overflow */
            }
             .side-menu.active {
                left: 0;
            }

            
            .main-content {
                padding: 15px;
            }
            
            .quick-actions {
                flex-direction: row; /* Keep horizontal but allow wrapping */
                justify-content: space-around; /* Distribute space */
            }
            .quick-action {
                flex-basis: calc(33.33% - 10px); /* Approx 3 per row, accounts for gap */
            }

            .contact-methods {
                grid-template-columns: 1fr;
            }
            #notification-container {
                top: 70px; /* Adjust if header height changes */
                width: calc(100% - 30px);
            }
            .slide img {
                height: 250px; /* Adjust slide height */
            }
        }

        @media (max-width: 480px) {
            #auth-options {
                flex-direction: column;
                gap: 15px; /* Increased gap */
            }
            
            .auth-btn {
                width: 100%;
            }
            .auth-form {
                padding: 20px;
            }
            
            .modal-content {
                padding: 20px;
                margin: 0 10px; /* Prevent touching screen edges */
            }
            
            .modal-buttons {
                flex-direction: column-reverse; /* Confirm on top for easier reach */
                gap: 10px;
            }
            
            .modal-btn {
                width: 100%;
            }
            
            .history-filter, .earnings-filter {
                flex-direction: column;
                align-items: stretch; /* Make select full width */
            }
            .history-filter select, .earnings-filter select {
                width: 100%;
            }
            .quick-action {
                flex-basis: calc(50% - 8px); /* Approx 2 per row */
            }
            .app-logo h1 {
                font-size: 1rem; /* Smaller app title in header */
            }
            .slide img {
                height: 200px;
            }
            .prev, .next {
                padding: 12px;
                font-size: 16px;
            }
            .dot {
                height: 10px;
                width: 10px;
            }
            .deposit-methods .method-card {
                min-width: 140px; /* Adjust for USDT text */
                padding: 10px;
            }
            .deposit-methods .method-card img {
                height: 30px;
            }
            .detail-label {
                width: 100%; /* Stack label and value */
                margin-bottom: 3px;
            }
            .detail-value-container {
                width: 100%;
                flex-direction: column; /* Stack address and copy button on small screens */
                align-items: flex-start;
            }
            .detail-value {
                width: 100%;
                margin-bottom: 5px;
            }
            .copy-address-btn {
                margin-left: 0;
                margin-top: 5px;
            }
        }

    </style>
</head>
<body>
    <!-- Auth Container -->
    <div id="auth-container" class="container">
        <div class="logo-container">
            <img src="https://cdn-icons-png.flaticon.com/512/2936/2936886.png" alt="Video Treasure Logo" class="logo">
            <h1 class="app-title">Video Treasure Pro</h1>
        </div>
        
        <div id="auth-options">
            <button id="register-btn" class="auth-btn animate__animated animate__fadeInUp">Register</button>
            <button id="login-btn" class="auth-btn animate__animated animate__fadeInUp">Login</button>
        </div>
        
        <div id="register-form" class="auth-form hidden">
            <h2>Create Account</h2>
            <div class="form-group">
                <i class="fas fa-user"></i>
                <input type="text" id="reg-name" placeholder="Full Name" required>
            </div>
            <div class="form-group">
                <i class="fas fa-envelope"></i>
                <input type="email" id="reg-email" placeholder="Email" required>
            </div>
            <div class="form-group password-container has-strength">
                <i class="fas fa-lock"></i>
                <input type="password" id="reg-password" placeholder="Password" required>
                <span class="password-toggle"><i class="fas fa-eye"></i></span>
                <div class="password-strength">
                    <span class="strength-bar"></span>
                    <span class="strength-bar"></span>
                    <span class="strength-bar"></span>
                    <span class="strength-text"></span>
                </div>
            </div>
            <div class="form-group password-container">
                <i class="fas fa-lock"></i>
                <input type="password" id="reg-confirm-password" placeholder="Confirm Password" required>
            </div>
            <div class="form-group">
                <i class="fas fa-phone"></i>
                <input type="text" id="reg-phone" placeholder="Phone Number (e.g., +15551234567)" required>
            </div>
            <div class="form-group">
                <i class="fas fa-user-plus"></i>
                <input type="text" id="reg-invite" placeholder="Invitation Code (Optional)">
            </div>
            <div class="form-group terms">
                <input type="checkbox" id="reg-terms">
                <label for="reg-terms">I agree to the <a href="#" id="terms-link">Terms & Conditions</a></label>
            </div>
            <button id="submit-register" class="submit-btn">
                <span class="btn-text">Register</span>
                <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
            </button>
            <p class="auth-switch">Already have an account? <span id="switch-to-login">Login</span></p>
        </div>
        
        <div id="login-form" class="auth-form hidden">
            <h2>Login</h2>
            <div class="form-group">
                <i class="fas fa-envelope"></i>
                <input type="email" id="login-email" placeholder="Email" required>
            </div>
            <div class="form-group password-container">
                <i class="fas fa-lock"></i>
                <input type="password" id="login-password" placeholder="Password" required>
                <span class="password-toggle"><i class="fas fa-eye"></i></span>
            </div>
            <button id="submit-login" class="submit-btn">
                <span class="btn-text">Login</span>
                <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
            </button>
            <p class="forgot-password" id="forgot-password">Forgot Password?</p>
            <p class="auth-switch">Don't have an account? <span id="switch-to-register">Register</span></p>
        </div>
        
        <div id="reset-form" class="auth-form hidden">
            <h2>Reset Password</h2>
            <div class="form-group">
                <i class="fas fa-envelope"></i>
                <input type="email" id="reset-email" placeholder="Enter your email" required>
            </div>
            <button id="submit-reset" class="submit-btn">
                <span class="btn-text">Send Reset Link</span>
                <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
            </button>
            <p class="auth-switch">Remember your password? <span id="switch-to-login-from-reset">Login</span></p>
        </div>
        
        <div id="email-verify-notice" class="auth-form hidden">
            <h2>Verify Your Email</h2>
            <i class="fas fa-envelope-open-text verify-icon"></i>
            <p>We've sent a verification email to <strong id="verify-email-address">your.email@example.com</strong>. Please check your inbox (and spam folder) and click the verification link to activate your account.</p>
            <p>Didn't receive the email? <span id="resend-verify" class="auth-switch">Resend Email</span></p>
            <button id="verify-continue" class="submit-btn hidden">Continue (after verification)</button>
        </div>
    </div>
    
    <!-- Main App Container (Initially Hidden) -->
    <div id="app-container" class="hidden">
        <!-- Header -->
        <header class="app-header">
            <div class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
            <div class="app-logo">
                <img src="https://cdn-icons-png.flaticon.com/512/2936/2936886.png" alt="Video Treasure Logo">
                <h1>Video Treasure Pro</h1>
            </div>
            <div class="user-info">
                <div class="balance-container">
                    <span id="user-balance">$0.00</span>
                    <i class="fas fa-sync-alt refresh-balance" id="refresh-balance" title="Refresh Balance"></i>
                </div>
                <div class="user-avatar" id="user-profile">
                    <i class="fas fa-user-circle"></i>
                    <span class="online-status"></span>
                </div>
            </div>
        </header>
        
        <!-- Side Menu -->
        <div class="side-menu" id="side-menu">
            <div class="menu-header">
                <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="User Profile" id="menu-user-img">
                <h3 id="menu-username">User Name</h3>
                <span id="menu-user-email">user@example.com</span>
                <div class="user-level">
                    <span id="user-level-badge">Standard</span>
                </div>
            </div>
            <ul class="menu-items">
                <li class="menu-item active" data-page="home"><i class="fas fa-home"></i> <span>Home</span></li>
                <li class="menu-item" data-page="team"><i class="fas fa-users"></i> <span>Team</span></li>
                <li class="menu-item" data-page="plans"><i class="fas fa-box-open"></i> <span>Plans</span></li>
                <li class="menu-item" data-page="deposit"><i class="fas fa-money-bill-wave"></i> <span>Deposit</span></li>
                <li class="menu-item" data-page="withdraw"><i class="fas fa-wallet"></i> <span>Withdraw</span></li>
                <li class="menu-item" data-page="deposit-history"><i class="fas fa-history"></i> <span>Deposit History</span></li>
                <li class="menu-item" data-page="withdraw-history"><i class="fas fa-clock"></i> <span>Withdraw History</span></li>
                <li class="menu-item" data-page="earnings"><i class="fas fa-chart-line"></i> <span>Earnings</span></li>
                <li class="menu-item" data-page="contact"><i class="fas fa-headset"></i> <span>Contact Us</span></li>
                <li class="menu-item" id="logout-btn"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></li>
            </ul>
            <div class="menu-footer">
                <p>Version 2.0.1</p>
            </div>
        </div>
        
        <!-- Main Content -->
        <main class="main-content" id="main-content">
            <!-- Loading Overlay -->
            <div id="loading-overlay" class="hidden">
                <div class="loader-content">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading...</p>
                </div>
            </div>
            
            <!-- Home Page -->
            <div class="page" id="home-page">
                <div class="slideshow-container">
                    <div class="slide fade">
                        <img src="https://images.unsplash.com/photo-1620714223084-8fcacc6dfd8d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTF8fGludmVzdG1lbnQlMjBncm93dGh8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=800&q=60" style="width:100%">
                        <div class="slide-content">
                            <h3>Earn Daily 5% Returns</h3>
                            <p>Invest in our plans and get guaranteed daily returns.</p>
                        </div>
                    </div>
                    <div class="slide fade">
                        <img src="https://images.unsplash.com/photo-1556761175-5973dc0f32e7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8cmVmZXJyYWwlMjBwcm9ncmFtfGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60" style="width:100%">
                        <div class="slide-content">
                            <h3>Refer & Earn 10%</h3>
                            <p>Get commissions on your referrals' investments.</p>
                        </div>
                    </div>
                    <div class="slide fade">
                        <img src="https://images.pexels.com/photos/50987/money-card-business-credit-card-50987.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" style="width:100%">
                        <div class="slide-content">
                            <h3>Easy Withdrawals</h3>
                            <p>Withdraw your earnings via USDT (BEP20/TRC20).</p>
                        </div>
                    </div>
                    <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
                    <a class="next" onclick="plusSlides(1)">&#10095;</a>
                </div>
                <br>
                <div class="dot-container" style="text-align:center">
                    <span class="dot" onclick="currentSlide(1)"></span> 
                    <span class="dot" onclick="currentSlide(2)"></span> 
                    <span class="dot" onclick="currentSlide(3)"></span> 
                </div>
                
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Total Balance</h3>
                            <p id="total-balance">$0.00</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-crown"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Active Plan</h3>
                            <p id="active-plan">None</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Daily Earnings</h3>
                            <p id="daily-earnings">$0.00</p>
                        </div>
                    </div>
                </div>
                
                <div class="quick-actions">
                    <button class="quick-action" id="quick-deposit">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Deposit</span>
                    </button>
                    <button class="quick-action" id="quick-withdraw">
                        <i class="fas fa-wallet"></i>
                        <span>Withdraw</span>
                    </button>
                    <button class="quick-action" id="quick-invite">
                        <i class="fas fa-user-plus"></i>
                        <span>Invite</span>
                    </button>
                </div>
                
                <div class="announcement-card">
                    <h3><i class="fas fa-bullhorn"></i> Announcement</h3>
                    <div class="announcement-content">
                        <p id="announcement-text">Welcome to Video Treasure Pro! Start investing today to earn daily returns. Check out our plans and referral program for maximum earnings!</p>
                    </div>
                </div>
            </div>
            
            <!-- Team Page -->
            <div class="page hidden" id="team-page">
                <div class="page-header">
                    <h2>Your Team & Rankings</h2>
                </div>
                <div class="ranking-header">
                    <h3>Your Current Rank</h3>
                    <div class="rank-badge" id="user-rank-badge">
                        <span>#0</span>
                        <i class="fas fa-trophy"></i>
                    </div>
                </div>
                
                <button id="view-ranking-btn" class="action-btn">
                    <i class="fas fa-list-ol"></i> View Full Ranking
                </button>
                
                <div class="ranking-table hidden" id="ranking-table">
                    <h3>Top 10 Investors</h3>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Name</th>
                                    <th>Investment</th>
                                    <th>Earnings</th>
                                </tr>
                            </thead>
                            <tbody id="ranking-body">
                                <!-- Filled by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="invitation-section">
                    <h3><i class="fas fa-user-plus"></i> Your Invitation Code</h3>
                    <div class="invite-code-container">
                        <input type="text" id="invite-code" readonly>
                        <button id="copy-invite" class="copy-btn">
                            <i class="far fa-copy"></i> Copy
                        </button>
                    </div>
                    <p class="invite-note">Share this code with friends to earn 10% commission on their investments!</p>
                    
                    <div class="referral-stats">
                        <div class="referral-stat">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h4>Total Referrals</h4>
                                <p id="total-referrals">0</p>
                            </div>
                        </div>
                        <div class="referral-stat">
                            <div class="stat-icon">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                            <div class="stat-info">
                                <h4>Referral Earnings</h4>
                                <p id="referral-earnings">$0.00</p>
                            </div>
                        </div>
                        <div class="referral-stat">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <div class="stat-info">
                                <h4>Today's Referrals</h4>
                                <p id="today-referral-earnings">$0.00</p>
                            </div>
                        </div>
                        <div class="referral-stat">
                            <div class="stat-icon">
                                <i class="fas fa-bullseye"></i>
                            </div>
                            <div class="stat-info">
                                <h4>Referral Target</h4>
                                <p id="referral-target">0/5</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="referral-share">
                        <h4>Share Your Link:</h4>
                        <div class="share-buttons">
                            <button class="share-btn whatsapp">
                                <i class="fab fa-whatsapp"></i> WhatsApp
                            </button>
                            <button class="share-btn facebook">
                                <i class="fab fa-facebook"></i> Facebook
                            </button>
                            <button class="share-btn copy-link">
                                <i class="fas fa-link"></i> Copy Link
                            </button>
                        </div>
                    </div>
                    
                    <h3><i class="fas fa-history"></i> Referral History</h3>
                    <div class="table-responsive">
                        <table class="referral-table history-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Plan</th>
                                    <th>Earnings</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="referral-body">
                                <!-- Filled by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Plans Page -->
            <div class="page hidden" id="plans-page">
                <div class="page-header">
                    <h2>Investment Plans</h2>
                </div>
                <p class="page-description">Choose a plan to start earning daily 5% returns for 30 days.</p>
                
                <div class="plans-container">
                    <div class="plan-card">
                        <h3>Basic Plan</h3>
                        <div class="plan-price">$5</div>
                        <div class="plan-duration">
                            <i class="fas fa-calendar-alt"></i> 30 Days
                        </div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check-circle"></i> Daily Earnings: 5%</li>
                            <li><i class="fas fa-check-circle"></i> Total Return: 150%</li>
                            <li><i class="fas fa-check-circle"></i> Principal Included</li>
                            <li><i class="fas fa-check-circle"></i> 24/7 Support</li>
                        </ul>
                        <button class="buy-plan-btn" data-plan="5">
                            <span class="btn-text">Buy Now</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                    </div>
                    
                    <div class="plan-card popular">
                        <div class="popular-badge">Most Popular</div>
                        <h3>Silver Plan</h3>
                        <div class="plan-price">$10</div>
                        <div class="plan-duration">
                            <i class="fas fa-calendar-alt"></i> 30 Days
                        </div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check-circle"></i> Daily Earnings: 5%</li>
                            <li><i class="fas fa-check-circle"></i> Total Return: 150%</li>
                            <li><i class="fas fa-check-circle"></i> Principal Included</li>
                            <li><i class="fas fa-check-circle"></i> 24/7 Support</li>
                        </ul>
                        <button class="buy-plan-btn" data-plan="10">
                            <span class="btn-text">Buy Now</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                    </div>
                    
                    <div class="plan-card">
                        <h3>Gold Plan</h3>
                        <div class="plan-price">$25</div>
                        <div class="plan-duration">
                            <i class="fas fa-calendar-alt"></i> 30 Days
                        </div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check-circle"></i> Daily Earnings: 5%</li>
                            <li><i class="fas fa-check-circle"></i> Total Return: 150%</li>
                            <li><i class="fas fa-check-circle"></i> Principal Included</li>
                            <li><i class="fas fa-check-circle"></i> 24/7 Support</li>
                        </ul>
                        <button class="buy-plan-btn" data-plan="25">
                            <span class="btn-text">Buy Now</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                    </div>
                    
                    <div class="plan-card">
                        <h3>Platinum Plan</h3>
                        <div class="plan-price">$50</div>
                        <div class="plan-duration">
                            <i class="fas fa-calendar-alt"></i> 30 Days
                        </div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check-circle"></i> Daily Earnings: 5%</li>
                            <li><i class="fas fa-check-circle"></i> Total Return: 150%</li>
                            <li><i class="fas fa-check-circle"></i> Principal Included</li>
                            <li><i class="fas fa-check-circle"></i> 24/7 Support</li>
                        </ul>
                        <button class="buy-plan-btn" data-plan="50">
                            <span class="btn-text">Buy Now</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                    </div>
                    
                    <div class="plan-card">
                        <h3>Diamond Plan</h3>
                        <div class="plan-price">$100</div>
                        <div class="plan-duration">
                            <i class="fas fa-calendar-alt"></i> 30 Days
                        </div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check-circle"></i> Daily Earnings: 5%</li>
                            <li><i class="fas fa-check-circle"></i> Total Return: 150%</li>
                            <li><i class="fas fa-check-circle"></i> Principal Included</li>
                            <li><i class="fas fa-check-circle"></i> 24/7 Support</li>
                        </ul>
                        <button class="buy-plan-btn" data-plan="100">
                            <span class="btn-text">Buy Now</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                    </div>
                </div>
                
                <div class="plan-info-card">
                    <h3><i class="fas fa-info-circle"></i> Plan Information</h3>
                    <div class="info-content">
                        <p><strong>Daily Earnings:</strong> 5% of your investment amount</p>
                        <p><strong>Duration:</strong> 30 days (including weekends)</p>
                        <p><strong>Total Return:</strong> 150% (Principal + 50% profit)</p>
                        <p><strong>Withdrawals:</strong> Daily earnings can be withdrawn anytime (Min. $2)</p>
                        <p><strong>Principal:</strong> Returned at the end of the plan period</p>
                    </div>
                </div>
            </div>
            
            <!-- Deposit Page -->
            <div class="page hidden" id="deposit-page">
                <div class="page-header">
                    <h2>Deposit Funds</h2>
                </div>
                 <p class="page-description">Add funds to your account to purchase investment plans. Use USDT (BEP20 or TRC20) for deposits.</p>
                
                <div class="deposit-methods">
                    <div class="method-card active" data-method="usdt_bep20">
                        <img src="https://cdn-icons-png.flaticon.com/512/825/825478.png" alt="USDT BEP20">
                        <span>USDT (BEP20)</span>
                    </div>
                    <div class="method-card" data-method="usdt_trc20">
                        <img src="https://cdn-icons-png.flaticon.com/512/825/825478.png" alt="USDT TRC20">
                        <span>USDT (TRC20)</span>
                    </div>
                </div>
                
                <div class="deposit-instructions">
                    <h3><i class="fas fa-info-circle"></i> Deposit Instructions (<span id="deposit-method-name">USDT BEP20</span>)</h3>
                    <p>Send USDT to the following address:</p>
                    <div class="account-details">
                        <div class="detail-item">
                            <span class="detail-label" id="deposit-account-label1">Deposit Address (BEP20):</span>
                            <div class="detail-value-container">
                                <span class="detail-value" id="deposit-account-number">0xeb0ee64208106984101b1f127cf221358771dbfa</span>
                                <button id="copy-deposit-address" class="copy-address-btn">
                                    <i class="far fa-copy"></i> Copy
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="important-note">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>After sending USDT, fill the form below to verify your deposit. Processing time: 5-30 minutes. Ensure you send to the correct network address.</p>
                    </div>
                </div>
                
                <div class="deposit-form">
                    <h3><i class="fas fa-edit"></i> Deposit Form</h3>
                    <div class="form-group">
                        <label for="deposit-amount">Amount (USD)</label>
                        <select id="deposit-amount" class="form-select">
                            <option value="">Select Amount</option>
                            <option value="5">$5 (Basic Plan)</option>
                            <option value="10">$10 (Silver Plan)</option>
                            <option value="25">$25 (Gold Plan)</option>
                            <option value="50">$50 (Platinum Plan)</option>
                            <option value="100">$100 (Diamond Plan)</option>
                            <option value="other">Other Amount</option>
                        </select>
                        <div id="custom-amount-container" class="hidden">
                            <input type="number" id="custom-amount" placeholder="Enter custom amount (Min $5)" min="5">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="deposit-transaction">Transaction ID / Hash</label>
                        <input type="text" id="deposit-transaction" placeholder="Enter transaction ID or hash" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="deposit-sender">Your Sending Wallet Address (Optional)</label>
                        <input type="text" id="deposit-sender" placeholder="e.g., Your USDT sending wallet address">
                    </div>
                                        
                    <button id="submit-deposit" class="submit-btn">
                        <span class="btn-text">Submit Deposit</span>
                        <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                    </button>
                </div>
            </div>
            
            <!-- Withdraw Page -->
            <div class="page hidden" id="withdraw-page">
                <div class="page-header">
                    <h2>Withdraw Funds</h2>
                </div>
                <p class="page-description">Minimum withdrawal amount: $2. Max $500 per transaction. Withdrawals via USDT.</p>
                
                <div class="withdraw-info-card">
                    <div class="info-item">
                        <i class="fas fa-wallet"></i>
                        <div class="info-content">
                            <h4>Available Balance</h4>
                            <p id="withdraw-available-balance">$0.00</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-clock"></i>
                        <div class="info-content">
                            <h4>Processing Time</h4>
                            <p>1-6 hours (During business hours)</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-percentage"></i>
                        <div class="info-content">
                            <h4>Withdrawal Fee</h4>
                            <p>5% (Standard)</p>
                        </div>
                    </div>
                </div>
                
                <div class="withdraw-form">
                    <h3><i class="fas fa-money-bill-wave"></i> Withdrawal Request</h3>
                    
                    <div class="form-group">
                        <label for="withdraw-method">Withdrawal Method</label>
                        <select id="withdraw-method" class="form-select">
                            <option value="">Select Method</option>
                            <option value="usdt_bep20">USDT (BEP20)</option>
                            <option value="usdt_trc20">USDT (TRC20)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="withdraw-account">Your USDT Wallet Address</label>
                        <input type="text" id="withdraw-account" placeholder="Enter your USDT (BEP20/TRC20) Address" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="withdraw-name">Account Holder Name (Optional)</label>
                        <input type="text" id="withdraw-name" placeholder="Enter name associated with account if any">
                    </div>
                    
                    <div class="form-group">
                        <label for="withdraw-amount">Amount (USD)</label>
                        <input type="number" id="withdraw-amount" placeholder="Enter amount (Min $2)" min="2" max="500" required>
                        <div class="amount-buttons">
                            <button class="amount-btn" data-amount="2">$2</button>
                            <button class="amount-btn" data-amount="5">$5</button>
                            <button class="amount-btn" data-amount="10">$10</button>
                            <button class="amount-btn" data-amount="20">$20</button>
                            <button class="amount-btn" data-amount="50">$50</button>
                        </div>
                    </div>
                    
                    <button id="submit-withdraw" class="submit-btn">
                        <span class="btn-text">Request Withdrawal</span>
                        <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                    </button>
                </div>
            </div>
            
            <!-- Deposit History Page -->
            <div class="page hidden" id="deposit-history-page">
                <div class="page-header">
                    <h2>Deposit History</h2>
                    <div class="history-filter">
                        <select id="deposit-filter" class="form-select">
                            <option value="all">All Deposits</option>
                            <option value="pending">Pending</option>
                            <option value="completed">Completed</option>
                            <option value="rejected">Rejected</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Amount</th>
                                <th>Method</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="deposit-history-body">
                            <!-- Filled by JS -->
                        </tbody>
                    </table>
                </div>
                
                <div class="history-summary">
                    <div class="summary-card">
                        <h4>Total Deposits</h4>
                        <p id="total-deposits">$0.00</p>
                    </div>
                    <div class="summary-card">
                        <h4>Pending Deposits</h4>
                        <p id="pending-deposits">$0.00</p>
                    </div>
                    <div class="summary-card">
                        <h4>Completed Deposits</h4>
                        <p id="completed-deposits">$0.00</p>
                    </div>
                </div>
            </div>
            
            <!-- Withdraw History Page -->
            <div class="page hidden" id="withdraw-history-page">
                <div class="page-header">
                    <h2>Withdrawal History</h2>
                    <div class="history-filter">
                        <select id="withdraw-filter" class="form-select">
                            <option value="all">All Withdrawals</option>
                            <option value="pending">Pending</option>
                            <option value="completed">Completed</option>
                            <option value="rejected">Rejected</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Amount</th>
                                <th>Method</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="withdraw-history-body">
                            <!-- Filled by JS -->
                        </tbody>
                    </table>
                </div>
                
                <div class="history-summary">
                    <div class="summary-card">
                        <h4>Total Withdrawals</h4>
                        <p id="total-withdrawals">$0.00</p>
                    </div>
                    <div class="summary-card">
                        <h4>Pending Withdrawals</h4>
                        <p id="pending-withdrawals">$0.00</p>
                    </div>
                    <div class="summary-card">
                        <h4>Completed Withdrawals</h4>
                        <p id="completed-withdrawals">$0.00</p>
                    </div>
                </div>
            </div>
            
            <!-- Earnings Page -->
            <div class="page hidden" id="earnings-page">
                <div class="page-header">
                    <h2>Your Earnings</h2>
                    <div class="earnings-filter">
                        <select id="earnings-period" class="form-select">
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="all">All Time</option>
                        </select>
                    </div>
                </div>
                
                <div class="earnings-stats">
                    <div class="stat-card large">
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Total Earnings (All Time)</h3>
                            <p id="total-earnings">$0.00</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Today's Earnings</h3>
                            <p id="today-earnings">$0.00</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Referral Earnings</h3>
                            <p id="all-referral-earnings">$0.00</p>
                        </div>
                    </div>
                </div>
                
                <div class="earnings-chart-container">
                    <h3><i class="fas fa-chart-line"></i> Earnings Overview</h3>
                    <canvas id="earnings-chart"></canvas>
                </div>
                
                <div class="earnings-table-container">
                    <h3><i class="fas fa-list"></i> Recent Earnings</h3>
                    <div class="table-responsive">
                        <table class="earnings-table history-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Amount</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody id="earnings-body">
                                <!-- Filled by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Contact Page -->
            <div class="page hidden" id="contact-page">
                <div class="page-header">
                    <h2>Contact Us</h2>
                </div>
                 <p class="page-description">Have questions or need help? Contact our support team.</p>
                
                <div class="contact-methods">
                    <div class="contact-card whatsapp">
                        <div class="contact-icon">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <h3>WhatsApp Support</h3>
                        <p>Contact us directly on WhatsApp for quick assistance with your queries.</p>
                        <a href="https://wa.me/1XXXXXXXXXX" target="_blank" class="contact-btn">Chat Now</a> <!-- Placeholder Number -->
                    </div>
                    
                    <div class="contact-card email">
                        <div class="contact-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <h3>Email Support</h3>
                        <p>Send us an email, and our team will respond within 24 hours.</p>
                        <a href="mailto:support@videotreasure.com" class="contact-btn">Email Us</a>
                    </div>
                    
                    <div class="contact-card phone">
                        <div class="contact-icon">
                            <i class="fas fa-phone-alt"></i>
                        </div>
                        <h3>Call Support</h3>
                        <p>Call us during business hours (10AM - 6PM, Mon-Fri, EST).</p>
                        <a href="tel:+1XXXXXXXXXX" class="contact-btn">Call Now</a> <!-- Placeholder Number -->
                    </div>
                </div>
                
                <div class="contact-form-container">
                    <h3><i class="fas fa-paper-plane"></i> Send us a Message</h3>
                    <form id="contact-form">
                        <div class="form-group">
                            <label for="contact-name">Your Name</label>
                            <input type="text" id="contact-name" placeholder="Enter your name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="contact-email">Email Address</label>
                            <input type="email" id="contact-email" placeholder="Enter your email" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="contact-subject">Subject</label>
                            <input type="text" id="contact-subject" placeholder="Enter subject" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="contact-message">Message</label>
                            <textarea id="contact-message" rows="5" placeholder="Enter your message" required></textarea>
                        </div>
                        
                        <button type="submit" class="submit-btn">
                            <span class="btn-text">Send Message</span>
                            <span class="btn-loader hidden"><i class="fas fa-spinner fa-spin"></i></span>
                        </button>
                    </form>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Notification System -->
    <div id="notification-container"></div>
    
    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="modal hidden">
        <div class="modal-content animate__animated animate__fadeInDown animate__faster">
            <div class="modal-icon">
                <i class="fas fa-check-circle success"></i>
                <i class="fas fa-exclamation-circle warning"></i>
                <i class="fas fa-times-circle error"></i>
            </div>
            <h3 id="modal-title">Confirm Action</h3>
            <p id="modal-message">Are you sure you want to perform this action?</p>
            <div class="modal-buttons">
                <button id="modal-cancel" class="modal-btn cancel">Cancel</button>
                <button id="modal-confirm" class="modal-btn confirm">Confirm</button>
            </div>
        </div>
    </div>
    
    <!-- Terms Modal -->
    <div id="terms-modal" class="modal hidden">
        <div class="modal-content terms-content animate__animated animate__fadeInUp animate__faster">
            <h3>Terms & Conditions</h3>
            <div class="terms-text">
                <p><strong>Last Updated: July 2024</strong></p>
                
                <h4>1. Investment Plans</h4>
                <p>All investment plans offered by Video Treasure Pro have a fixed duration of 30 days. Daily earnings are calculated at a rate of 5% of the principal investment amount. These earnings are credited daily to your account balance.</p>
                
                <h4>2. Withdrawals</h4>
                <p>The minimum amount for withdrawal is $2. Withdrawal requests are typically processed within 1 to 6 hours during standard business hours (10:00 AM to 6:00 PM, Monday to Friday, EST). A standard withdrawal fee of 5% applies to all transactions. Maximum withdrawal per transaction is $500. Withdrawals are processed in USDT (BEP20 or TRC20).</p>
                
                <h4>3. Referral Program</h4>
                <p>Users can earn a 10% commission on the investment amounts of their referred users. Commissions are credited to the referrer's account immediately after the referred user's deposit is successfully verified and their plan is activated.</p>
                
                <h4>4. Account Security</h4>
                <p>You are solely responsible for maintaining the confidentiality of your account credentials, including your password. Video Treasure Pro is not liable for any loss or damage arising from your failure to protect your account. You must notify us immediately of any unauthorized use of your account or any other breach of security.</p>
                
                <h4>5. Amendments to Terms</h4>
                <p>Video Treasure Pro reserves the right to modify these Terms & Conditions at any time without prior notice. Any changes will be effective immediately upon posting the revised terms on the platform. Your continued use of the platform after such modifications constitutes your acceptance of the new Terms & Conditions.</p>
                
                <h4>6. Prohibited Activities</h4>
                <p>Users are prohibited from creating multiple accounts, using automated scripts or bots, engaging in fraudulent activities, or attempting to exploit any vulnerabilities in the system. Violation of these terms may result in account suspension or termination and forfeiture of funds.</p>

                <h4>7. Disclaimer of Liability</h4>
                <p>Video Treasure Pro provides its services "as is" and makes no warranties regarding the platform's reliability or profitability. Investment involves risk, and past performance is not indicative of future results. We are not responsible for any financial losses incurred by users.</p>
            </div>
            <button id="terms-accept" class="submit-btn">I Understand & Accept</button>
        </div>
    </div>
        
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // app.js
        // Firebase configuration
        // IMPORTANT: Replace placeholders with your actual Firebase project credentials
        const firebaseConfig = {
            apiKey: "AIzaSyCDJDsUZ-RwkC5h2LH7mRql1SSixINGT-8", // Replace with your actual API key
            authDomain: "video-apk-8af78.firebaseapp.com",
            databaseURL: "https://video-apk-8af78-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "video-apk-8af78",
            storageBucket: "video-apk-8af78.appspot.com",
            messagingSenderId: "1234567890", // Replace with your actual Sender ID
            appId: "1:272112220572:android:d5f72b22ea35d714a47059" // Replace with your actual App ID
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // DOM Elements
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        const registerBtn = document.getElementById('register-btn');
        const loginBtn = document.getElementById('login-btn');
        const registerFormEl = document.getElementById('register-form'); 
        const loginFormEl = document.getElementById('login-form');     
        const resetFormEl = document.getElementById('reset-form');       
        const emailVerifyNotice = document.getElementById('email-verify-notice');
        const switchToLogin = document.getElementById('switch-to-login');
        const switchToRegister = document.getElementById('switch-to-register');
        const forgotPassword = document.getElementById('forgot-password');
        const switchToLoginFromReset = document.getElementById('switch-to-login-from-reset');
        const submitRegister = document.getElementById('submit-register');
        const submitLogin = document.getElementById('submit-login');
        const submitReset = document.getElementById('submit-reset');
        const verifyContinue = document.getElementById('verify-continue');
        const resendVerify = document.getElementById('resend-verify');
        const verifyEmailAddressEl = document.getElementById('verify-email-address');

        const termsLink = document.getElementById('terms-link');
        const termsModal = document.getElementById('terms-modal');
        const termsAccept = document.getElementById('terms-accept');
        const menuToggle = document.getElementById('menu-toggle');
        const sideMenu = document.getElementById('side-menu');
        const menuItems = document.querySelectorAll('.menu-item');
        const pages = document.querySelectorAll('.page');
        const logoutBtn = document.getElementById('logout-btn');
        const notificationContainer = document.getElementById('notification-container');
        const confirmationModal = document.getElementById('confirmation-modal'); 
        const modalCancel = document.getElementById('modal-cancel');
        const modalConfirm = document.getElementById('modal-confirm');
        const loadingOverlay = document.getElementById('loading-overlay');
        const refreshBalance = document.getElementById('refresh-balance');
        const quickDeposit = document.getElementById('quick-deposit');
        const quickWithdraw = document.getElementById('quick-withdraw');
        const quickInvite = document.getElementById('quick-invite');

        // User data
        let currentUser = null;
        let userData = null;
        let earningsInterval = null;
        let lastEarningsUpdate = null;
        let earningsChartInstance = null; 

        // Initialize the app
        function init() {
            setupEventListeners();
            checkAuthState();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Auth buttons
            registerBtn.addEventListener('click', () => {
                showAuthForm(registerFormEl);
            });
            
            loginBtn.addEventListener('click', () => {
                showAuthForm(loginFormEl);
            });
            
            switchToLogin.addEventListener('click', () => {
                showAuthForm(loginFormEl);
            });
            
            switchToRegister.addEventListener('click', () => {
                showAuthForm(registerFormEl);
            });
            
            forgotPassword.addEventListener('click', () => {
                showAuthForm(resetFormEl);
            });
            
            switchToLoginFromReset.addEventListener('click', () => {
                showAuthForm(loginFormEl);
            });
            
            // Form submissions
            submitRegister.addEventListener('click', registerUser);
            submitLogin.addEventListener('click', loginUser);
            submitReset.addEventListener('click', resetUserPassword); 
            
            verifyContinue.addEventListener('click', () => {
                authContainer.classList.remove('hidden'); 
                emailVerifyNotice.classList.add('hidden');
                if (currentUser) {
                    currentUser.reload().then(() => {
                        if (currentUser.emailVerified) {
                            checkAuthState(); 
                        } else {
                            showNotification('Email not yet verified. Please check your inbox.', 'warning');
                        }
                    });
                }
            });
            resendVerify.addEventListener('click', resendVerificationEmail);
            
            // Terms and conditions
            termsLink.addEventListener('click', (e) => {
                e.preventDefault();
                termsModal.classList.add('active');
                termsModal.classList.remove('hidden');
            });
            termsAccept.addEventListener('click', () => {
                termsModal.classList.remove('active');
                termsModal.classList.add('hidden');

            });
            document.addEventListener('click', (event) => {
                if (event.target === termsModal) { 
                    termsModal.classList.remove('active');
                    termsModal.classList.add('hidden');
                }
                if (event.target === confirmationModal) {
                    confirmationModal.classList.remove('active');
                    confirmationModal.classList.add('hidden');
                }
            });

            
            // Menu toggle
            menuToggle.addEventListener('click', () => {
                sideMenu.classList.toggle('active');
            });
            
            // Menu items
            menuItems.forEach(item => {
                if (item.id !== 'logout-btn') {
                    item.addEventListener('click', () => {
                        navigateToPage(item.dataset.page);
                    });
                }
            });
            
            // Logout
            logoutBtn.addEventListener('click', logoutUser);
            
            // Modal buttons
            modalCancel.addEventListener('click', () => {
                confirmationModal.classList.remove('active');
                confirmationModal.classList.add('hidden');
            });
            
            // Password toggle
            document.querySelectorAll('.password-toggle').forEach(toggle => {
                toggle.addEventListener('click', function() {
                    const input = this.closest('.password-container').querySelector('input');
                    const icon = this.querySelector('i');
                    if (input.type === 'password') {
                        input.type = 'text';
                        icon.classList.replace('fa-eye', 'fa-eye-slash');
                    } else {
                        input.type = 'password';
                        icon.classList.replace('fa-eye-slash', 'fa-eye');
                    }
                });
            });
            
            // Password strength
            const passwordInput = document.getElementById('reg-password');
            if (passwordInput) {
                passwordInput.addEventListener('input', checkPasswordStrength);
            }
            
            // Deposit amount selection
            const depositAmountSelect = document.getElementById('deposit-amount'); 
            if (depositAmountSelect) {
                depositAmountSelect.addEventListener('change', function() {
                    const customAmountContainer = document.getElementById('custom-amount-container');
                    if (this.value === 'other') {
                        customAmountContainer.classList.remove('hidden');
                    } else {
                        customAmountContainer.classList.add('hidden');
                    }
                });
            }
                       
            // Quick actions
            if (quickDeposit) quickDeposit.addEventListener('click', () => navigateToPage('deposit'));
            if (quickWithdraw) quickWithdraw.addEventListener('click', () => navigateToPage('withdraw'));
            if (quickInvite) quickInvite.addEventListener('click', () => navigateToPage('team'));
            
            // Refresh balance
            if (refreshBalance) refreshBalance.addEventListener('click', refreshUserBalance);
            
            initSlideshow();
            initPlanButtons();
            initTransactionButtons();
            initCopyButton(); // For team page invite code
            initRankingButton();
            initShareButtons();
            initAmountButtons(); // For withdraw page
            initContactForm();
            initHistoryFilters();
        }

        function showAuthForm(formToShow) {
            [registerFormEl, loginFormEl, resetFormEl, emailVerifyNotice].forEach(form => {
                if (form) form.classList.add('hidden');
            });
            if (formToShow) formToShow.classList.remove('hidden');
            const authOptions = document.getElementById('auth-options');
            if (formToShow !== emailVerifyNotice && authOptions) { 
                 authOptions.classList.add('hidden');
            } else if (authOptions) {
                 authOptions.classList.remove('hidden');
            }
        }


        function navigateToPage(pageName) { 
            pages.forEach(p => p.classList.add('hidden'));
            const targetPage = document.getElementById(`${pageName}-page`);
            if (targetPage) {
                targetPage.classList.remove('hidden');
            } else {
                console.error(`Page with ID ${pageName}-page not found.`);
                document.getElementById('home-page').classList.remove('hidden'); 
            }

            menuItems.forEach(item => item.classList.remove('active'));
            const activeMenuItem = document.querySelector(`.menu-item[data-page="${pageName}"]`);
            if (activeMenuItem) {
                activeMenuItem.classList.add('active');
            }
            
            sideMenu.classList.remove('active');

            // Initialize page-specific content
            if (pageName === 'team') initTeamPage();
            else if (pageName === 'plans') initPlansPage();
            else if (pageName === 'deposit') initDepositPage();
            else if (pageName === 'withdraw') initWithdrawPage();
            else if (pageName === 'earnings') initEarningsPage();
            else if (pageName === 'deposit-history') loadDepositHistory();
            else if (pageName === 'withdraw-history') loadWithdrawHistory();
        }

        function checkAuthState() {
            showLoading();
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    
                    if (!user.emailVerified) {
                        showEmailVerificationNotice(user.email);
                        hideLoading();
                        return;
                    }
                    
                    loadUserData(user.uid); 
                    authContainer.classList.add('hidden');
                    document.getElementById('auth-options').classList.add('hidden'); 
                    appContainer.classList.remove('hidden');
                } else {
                    currentUser = null;
                    userData = null;
                    authContainer.classList.remove('hidden');
                    document.getElementById('auth-options').classList.remove('hidden'); 
                    appContainer.classList.add('hidden');
                    showAuthForm(loginFormEl); 
                    
                    if (earningsInterval) {
                        clearInterval(earningsInterval);
                        earningsInterval = null;
                    }
                    hideLoading();
                }
            });
        }

        function showEmailVerificationNotice(email) {
            [registerFormEl, loginFormEl, resetFormEl].forEach(form => form.classList.add('hidden'));
            document.getElementById('auth-options').classList.add('hidden');
            authContainer.classList.remove('hidden'); 

            emailVerifyNotice.classList.remove('hidden');
            if (verifyEmailAddressEl) verifyEmailAddressEl.textContent = email;
            
            setTimeout(() => {
                if (verifyContinue) verifyContinue.classList.remove('hidden');
            }, 5000);
        }

        function resendVerificationEmail() {
            if (!currentUser) return;
            
            showLoadingButton(resendVerify, true);
            currentUser.sendEmailVerification()
                .then(() => {
                    showNotification('Verification email sent! Check your inbox and spam folder.', 'success');
                })
                .catch(error => {
                    showNotification(`Error sending email: ${error.message}`, 'error');
                })
                .finally(() => {
                     showLoadingButton(resendVerify, false, "Resend Email");
                });
        }

        function loadUserData(userId) {
            showLoading();
            database.ref('users/' + userId).on('value', snapshot => {
                userData = snapshot.val();
                if (userData) {
                    updateUI();
                    startEarningsCalculation();
                    if (!authContainer.classList.contains('hidden')) { 
                         showNotification('Login successful!', 'success');
                    }
                } else {
                    console.warn("User data not found for UID:", userId);
                     // Potentially create default data if it's a new verified user but data is missing
                }
                hideLoading();
            }, error => {
                showNotification('Error loading user data: ' + error.message, 'error');
                logoutUser(); 
                hideLoading();
            });
        }

        function refreshUserBalance() {
            if (!currentUser) return;
            
            showLoading();
            database.ref('users/' + currentUser.uid).once('value')
                .then(snapshot => {
                    userData = snapshot.val();
                    if (userData) {
                        updateUI(); 
                        showNotification('Balance refreshed!', 'success');
                    }
                })
                .catch(error => {
                    showNotification('Error refreshing balance: ' + error.message, 'error');
                })
                .finally(() => {
                    hideLoading();
                });
        }

        function updateUI() {
            if (!currentUser || !userData) return;
            
            document.getElementById('menu-username').textContent = userData.name || 'User';
            document.getElementById('menu-user-email').textContent = currentUser.email;
            
            if (userData.profileImage) {
                document.getElementById('menu-user-img').src = userData.profileImage;
            } else {
                 document.getElementById('menu-user-img').src = "https://cdn-icons-png.flaticon.com/512/3135/3135715.png"; 
            }
            
            updateBalanceDisplay();
            
            const activePlanAmount = userData.activePlan || 0;
            const activePlanName = activePlanAmount > 0 ? `${getPlanName(activePlanAmount)} ($${activePlanAmount})` : 'None';
            document.getElementById('active-plan').textContent = activePlanName;
            
            const dailyEarningsVal = activePlanAmount > 0 ? (activePlanAmount * 0.05) : 0;
            document.getElementById('daily-earnings').textContent = `$${dailyEarningsVal.toFixed(2)}`;
            
            document.getElementById('invite-code').value = userData.inviteCode || currentUser.uid.slice(0, 8).toUpperCase();
            
            const referralsCount = userData.referrals ? Object.keys(userData.referrals).length : 0;
            const referralEarningsTotal = userData.referralEarnings || 0;
            document.getElementById('total-referrals').textContent = referralsCount;
            document.getElementById('referral-earnings').textContent = `$${referralEarningsTotal.toFixed(2)}`;
            
            const today = new Date().toISOString().split('T')[0];
            let todayReferralEarningsCount = 0;
            if (userData.referralHistory) {
                Object.values(userData.referralHistory).forEach(entry => {
                    if (entry.date && entry.date.startsWith(today)) {
                        todayReferralEarningsCount += entry.amount || 0;
                    }
                });
            }
            document.getElementById('today-referral-earnings').textContent = `$${todayReferralEarningsCount.toFixed(2)}`;
            
            const referralTargetCount = 5;
            document.getElementById('referral-target').textContent = `${referralsCount}/${referralTargetCount} ${referralsCount >= referralTargetCount ? '(Completed)' : ''}`;
            
            document.getElementById('user-rank-badge').innerHTML = `<span>#${userData.rank || 'N/A'}</span> <i class="fas fa-trophy"></i>`;

            let level = "Standard";
            if (userData.activePlan >= 100) level = "Diamond Investor"; // $100 Diamond
            else if (userData.activePlan >= 50) level = "Platinum Investor"; // $50 Platinum
            else if (userData.activePlan >= 25) level = "Gold Investor"; // $25 Gold
            else if (userData.activePlan >= 10) level = "Silver Investor"; // $10 Silver
            else if (userData.activePlan >= 5) level = "Basic Investor"; // $5 Basic
            document.getElementById('user-level-badge').textContent = level;
        }

        function getPlanName(amount) {
            if (amount === 5) return "Basic Plan";
            if (amount === 10) return "Silver Plan";
            if (amount === 25) return "Gold Plan";
            if (amount === 50) return "Platinum Plan";
            if (amount === 100) return "Diamond Plan";
            return "Custom Plan";
        }


        function updateBalanceDisplay() {
            if (!userData) return;
            const currentBalance = userData.balance || 0; 
            const currentEarnings = userData.earnings || 0; 
            const totalAvailable = currentBalance + currentEarnings;

            document.getElementById('user-balance').textContent = `$${totalAvailable.toFixed(2)}`;
            document.getElementById('total-balance').textContent = `$${totalAvailable.toFixed(2)}`;
            const withdrawAvailEl = document.getElementById('withdraw-available-balance');
            if (withdrawAvailEl) withdrawAvailEl.textContent = `$${totalAvailable.toFixed(2)}`;
        }

        function registerUser() {
            const name = document.getElementById('reg-name').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;
            const phone = document.getElementById('reg-phone').value.trim();
            const inviteCodeInput = document.getElementById('reg-invite').value.trim(); 
            const termsAccepted = document.getElementById('reg-terms').checked;
            
            if (!name || !email || !password || !confirmPassword || !phone) {
                showNotification('Please fill all required fields.', 'error'); return;
            }
            if (!validateEmail(email)) {
                showNotification('Invalid email address.', 'error'); return;
            }
            if (password !== confirmPassword) {
                showNotification('Passwords do not match.', 'error'); return;
            }
            if (password.length < 8 || !validatePassword(password)) {
                showNotification('Password must be at least 8 characters and include uppercase, lowercase, number, and special character.', 'error'); return;
            }
            
            const phoneRegex = /^\+?[1-9]\d{6,14}$/; // Basic international phone number regex
            if (!phoneRegex.test(phone)) {
                showNotification('Invalid phone number format. Please use international format (e.g., +15551234567).', 'error'); return;
            }
            if (!termsAccepted) {
                showNotification('Please accept the Terms & Conditions.', 'error'); return;
            }
            
            showLoadingButton(submitRegister, true);
            
            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    const user = userCredential.user;
                    return user.sendEmailVerification().then(() => user);
                })
                .then(user => {
                    const newUserRef = database.ref('users/' + user.uid); 
                    const newUserData = { 
                        name: name,
                        email: email,
                        phone: phone,
                        balance: 0,
                        earnings: 0,
                        referralEarnings: 0,
                        activePlan: null,
                        planStartDate: null,
                        inviteCode: generateInviteCode(),
                        referredBy: inviteCodeInput || null, 
                        registrationDate: new Date().toISOString(),
                        lastLogin: new Date().toISOString(),
                        rank: "New" 
                    };
                    
                    return newUserRef.set(newUserData).then(() => {
                        if (inviteCodeInput) {
                             checkReferral(inviteCodeInput, user.uid, name); 
                        }
                        showEmailVerificationNotice(email);
                        showNotification('Registration successful! Please verify your email to login.', 'success');
                    });
                })
                .catch(error => {
                    showNotification(error.message, 'error');
                })
                .finally(() => {
                    showLoadingButton(submitRegister, false, "Register");
                });
        }

        function generateInviteCode() {
            return 'VT' + Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(email).toLowerCase());
        }

        function validatePassword(password) {
            return /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/.test(password);
        }

        function checkPasswordStrength() {
            const password = document.getElementById('reg-password').value;
            const strengthBars = document.querySelectorAll('#register-form .strength-bar');
            const strengthText = document.querySelector('#register-form .strength-text');
            
            let score = 0;
            if (!password) {
                strengthBars.forEach(bar => bar.style.backgroundColor = 'var(--light-gray)');
                strengthText.textContent = '';
                return;
            }

            if (password.length >= 8) score++;
            if (password.length >= 10) score++;
            if (/[A-Z]/.test(password)) score++;
            if (/[0-9]/.test(password)) score++;
            if (/[^A-Za-z0-9]/.test(password)) score++;

            strengthBars.forEach((bar, index) => {
                bar.className = 'strength-bar'; 
                if (score === 0) {
                    bar.style.backgroundColor = 'var(--light-gray)';
                } else if (score <= 2 && index === 0) { 
                    bar.classList.add('weak');
                } else if (score > 2 && score <= 4) { 
                    if (index <=1) bar.classList.add('medium');
                    else bar.style.backgroundColor = 'var(--light-gray)';
                } else if (score >= 5) { 
                     bar.classList.add('strong');
                } else {
                    bar.style.backgroundColor = 'var(--light-gray)';
                }
            });
            
            if (score <= 2) {
                strengthText.textContent = 'Weak';
                strengthText.style.color = 'var(--danger-color)';
            } else if (score <= 4) {
                strengthText.textContent = 'Medium';
                strengthText.style.color = 'var(--warning-color)';
            } else {
                strengthText.textContent = 'Strong';
                strengthText.style.color = 'var(--success-color)';
            }
        }
        

        function checkReferral(referrerInviteCode, newUserId, newUserName) {
            database.ref('users').orderByChild('inviteCode').equalTo(referrerInviteCode).once('value')
            .then(snapshot => {
                if (snapshot.exists()) {
                    const referrerUid = Object.keys(snapshot.val())[0];
                    const referrerData = snapshot.val()[referrerUid];

                    const referralEntry = {
                        userId: newUserId,
                        name: newUserName || "New User", 
                        date: new Date().toISOString(),
                        status: 'pending_first_deposit' 
                    };

                    database.ref(`users/${referrerUid}/referrals/${newUserId}`).set(referralEntry)
                        .then(() => console.log(`Referral ${newUserId} added to ${referrerUid}`))
                        .catch(err => console.error("Error adding referral to referrer: ", err));
                    
                    database.ref(`users/${newUserId}/referredByUid`).set(referrerUid);

                } else {
                    console.warn("Referrer with invite code not found:", referrerInviteCode);
                }
            }).catch(error => {
                console.error("Error finding referrer by invite code: ", error);
            });
        }


        function loginUser() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showNotification('Please fill all fields.', 'error'); return;
            }
            
            showLoadingButton(submitLogin, true);
            
            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                     return database.ref('users/' + userCredential.user.uid).update({
                        lastLogin: new Date().toISOString()
                    });
                })
                .catch(error => {
                    showNotification(error.message, 'error');
                })
                .finally(() => {
                    showLoadingButton(submitLogin, false, "Login");
                });
        }

        function resetUserPassword() { 
            const email = document.getElementById('reset-email').value.trim();
            
            if (!email || !validateEmail(email)) {
                showNotification('Please enter a valid email.', 'error'); return;
            }
            
            showLoadingButton(submitReset, true);
            
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    showNotification('Password reset email sent! Check your inbox.', 'success');
                    showAuthForm(loginFormEl); 
                })
                .catch(error => {
                    showNotification(error.message, 'error');
                })
                .finally(() => {
                     showLoadingButton(submitReset, false, "Send Reset Link");
                });
        }

        function logoutUser() {
            showLoading();
            auth.signOut()
                .then(() => {
                })
                .catch(error => {
                    showNotification(error.message, 'error');
                })
                .finally(() => {
                    // State change will handle UI update and hideLoading
                });
        }

        function showLoadingButton(buttonElement, isLoading, defaultText = "Submit") {
            const btnText = buttonElement.querySelector('.btn-text');
            const btnLoader = buttonElement.querySelector('.btn-loader');

            if (isLoading) {
                if(btnText) btnText.classList.add('hidden');
                if(btnLoader) btnLoader.classList.remove('hidden');
                buttonElement.disabled = true;
            } else {
                if(btnText) {
                    btnText.classList.remove('hidden');
                    btnText.textContent = defaultText; 
                }
                if(btnLoader) btnLoader.classList.add('hidden');
                buttonElement.disabled = false;
            }
        }


        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type} animate__animated`; 
            
            let iconClass;
            switch (type) {
                case 'success': iconClass = 'fa-check-circle'; break;
                case 'error': iconClass = 'fa-times-circle'; break;
                case 'warning': iconClass = 'fa-exclamation-triangle'; break; 
                case 'info': iconClass = 'fa-info-circle'; break;
                default: iconClass = 'fa-bell';
            }
            
            notification.innerHTML = `<i class="fas ${iconClass}"></i><span>${message}</span>`;
            notificationContainer.appendChild(notification);
            
            notification.classList.add('animate__fadeInRight'); 
            
            setTimeout(() => {
                notification.classList.remove('animate__fadeInRight');
                notification.classList.add('animate__fadeOutUp'); 
                setTimeout(() => notification.remove(), 500); 
            }, 3500);
        }

        function showLoading() {
            if (loadingOverlay) loadingOverlay.classList.remove('hidden');
        }

        function hideLoading() {
            if (loadingOverlay) loadingOverlay.classList.add('hidden');
        }

        let slideIndex = 1; 
        let slideshowTimeout;

        function initSlideshow() {
            showSlides(slideIndex);
        }

        function plusSlides(n) {
            clearTimeout(slideshowTimeout);
            showSlides(slideIndex += n);
        }

        function currentSlide(n) {
            clearTimeout(slideshowTimeout);
            showSlides(slideIndex = n);
        }

        function showSlides(n) {
            let i;
            const slides = document.getElementsByClassName("slide");
            const dots = document.getElementsByClassName("dot");
            if (slides.length === 0 || dots.length === 0) return; // Prevent errors if elements not found

            if (n > slides.length) {slideIndex = 1}
            if (n < 1) {slideIndex = slides.length}
            
            for (i = 0; i < slides.length; i++) {
                slides[i].style.display = "none";
            }
            for (i = 0; i < dots.length; i++) {
                dots[i].className = dots[i].className.replace(" active-dot", "");
            }
            
            slides[slideIndex-1].style.display = "block";
            dots[slideIndex-1].className += " active-dot";
            
            slideshowTimeout = setTimeout(() => { plusSlides(1); }, 5000); 
        }

        function initPlanButtons() {
            const buyButtons = document.querySelectorAll('.buy-plan-btn');
            buyButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const planAmount = parseInt(this.dataset.plan);
                    purchasePlan(planAmount, this); 
                });
            });
        }
        
        function initPlansPage() {
            if (userData && userData.activePlan) {
                document.querySelectorAll('.buy-plan-btn').forEach(btn => {
                    btn.disabled = true;
                    btn.querySelector('.btn-text').textContent = "Plan Active";
                });
            } else {
                document.querySelectorAll('.buy-plan-btn').forEach(btn => {
                    btn.disabled = false;
                    btn.querySelector('.btn-text').textContent = "Buy Now";
                });
            }
        }


        function purchasePlan(planAmount, buttonElement) {
            if (!currentUser || !userData) {
                showNotification('Please login to purchase a plan.', 'error'); return;
            }
            
            const totalBalance = (userData.balance || 0) + (userData.earnings || 0);
            
            if (totalBalance < planAmount) {
                showNotification('Insufficient balance. Please deposit funds.', 'error'); return;
            }
            
            if (userData.activePlan) {
                showNotification('You already have an active plan. Wait for it to complete or contact support.', 'error'); return;
            }
            
            showConfirmationModal(
                `Confirm Plan Purchase`,
                `Purchase ${getPlanName(planAmount)} for $${planAmount}? You'll earn 5% daily for 30 days.`,
                () => {
                    showLoadingButton(buttonElement, true);
                    
                    let newEarnings = userData.earnings || 0;
                    let newBalance = userData.balance || 0;
                    let amountFromEarnings = 0;
                    let amountFromBalance = 0;

                    if (newEarnings >= planAmount) {
                        amountFromEarnings = planAmount;
                        newEarnings -= planAmount;
                    } else {
                        amountFromEarnings = newEarnings;
                        const remaining = planAmount - newEarnings;
                        newEarnings = 0;
                        amountFromBalance = remaining;
                        newBalance -= remaining;
                    }
                    
                    const updates = {
                        balance: newBalance,
                        earnings: newEarnings,
                        activePlan: planAmount,
                        planStartDate: new Date().toISOString(),
                        lastEarningsUpdate: new Date().toISOString() 
                    };
                    
                    database.ref('users/' + currentUser.uid).update(updates)
                        .then(() => {
                            const logEntry = {
                                type: 'plan_purchase',
                                amount: planAmount,
                                planName: getPlanName(planAmount),
                                date: new Date().toISOString(),
                                deductedFromBalance: amountFromBalance,
                                deductedFromEarnings: amountFromEarnings
                            };
                            database.ref(`users/${currentUser.uid}/transactions`).push(logEntry);

                            showNotification(`${getPlanName(planAmount)} purchased! Daily earnings: $${(planAmount * 0.05).toFixed(2)}.`, 'success');
                            if (document.getElementById('plans-page') && !document.getElementById('plans-page').classList.contains('hidden')) {
                                initPlansPage();
                            }
                            startEarningsCalculation(); 
                        })
                        .catch(error => {
                            showNotification(`Purchase error: ${error.message}`, 'error');
                        })
                        .finally(() => {
                            showLoadingButton(buttonElement, false, "Buy Now");
                        });
                }, 'success' 
            );
        }

        function startEarningsCalculation() {
            if (earningsInterval) clearInterval(earningsInterval); 

            if (!currentUser || !userData || !userData.activePlan || !userData.planStartDate) {
                return;
            }
            
            const planStartDate = new Date(userData.planStartDate);
            const planEndDate = new Date(planStartDate);
            planEndDate.setDate(planEndDate.getDate() + 30); 
            
            const now = new Date();

            if (now > planEndDate) {
                const principal = userData.activePlan;
                const updates = {
                    balance: (userData.balance || 0) + principal, 
                    activePlan: null,
                    planStartDate: null,
                    lastEarningsUpdate: null,
                    planCompletedOn: now.toISOString()
                };
                
                database.ref('users/' + currentUser.uid).update(updates)
                    .then(() => {
                        const logEntry = {
                            type: 'plan_completion',
                            amount: principal,
                            description: `Principal for ${getPlanName(principal)} returned.`,
                            date: now.toISOString()
                        };
                        database.ref(`users/${currentUser.uid}/transactions`).push(logEntry);
                        showNotification(`Your ${getPlanName(principal)} plan has completed! $${principal} principal returned to balance.`, 'success');
                    });
                return; 
            }
            
            const lastUpdate = userData.lastEarningsUpdate ? new Date(userData.lastEarningsUpdate) : planStartDate;
            const hoursPassedSinceLastUpdate = (now - lastUpdate) / (1000 * 60 * 60);
            
            if (hoursPassedSinceLastUpdate >= 1) { 
                const planAmount = userData.activePlan;
                const hourlyEarnings = (planAmount * 0.05) / 24;
                const missedEarnings = hourlyEarnings * Math.floor(hoursPassedSinceLastUpdate);
                
                if (missedEarnings > 0) {
                    const newTotalEarnings = (userData.earnings || 0) + missedEarnings;
                    const earningsUpdate = {
                        earnings: newTotalEarnings,
                        lastEarningsUpdate: now.toISOString()
                    };
                    const logEntry = {
                        type: 'investment_earning',
                        amount: missedEarnings,
                        plan: planAmount,
                        date: now.toISOString(),
                        description: `Hourly earnings catch-up`
                    };
                    database.ref(`users/${currentUser.uid}/earningsHistory`).push(logEntry);

                    database.ref('users/' + currentUser.uid).update(earningsUpdate);
                }
            }
            
            earningsInterval = setInterval(() => {
                if (!currentUser || !userData || !userData.activePlan) { 
                    clearInterval(earningsInterval);
                    return;
                }
                 const currentActivePlan = userData.activePlan; 
                 const currentPlanStartDate = new Date(userData.planStartDate);
                 const currentPlanEndDate = new Date(currentPlanStartDate);
                 currentPlanEndDate.setDate(currentPlanEndDate.getDate() + 30);

                if (new Date() > currentPlanEndDate) {
                    clearInterval(earningsInterval);
                    startEarningsCalculation(); 
                    return;
                }

                const planAmount = currentActivePlan;
                const hourlyRate = (planAmount * 0.05) / 24;
                
                const newTotalEarnings = (userData.earnings || 0) + hourlyRate;
                const updateData = {
                    earnings: newTotalEarnings,
                    lastEarningsUpdate: new Date().toISOString()
                };

                const logEntry = {
                    type: 'investment_earning',
                    amount: hourlyRate,
                    plan: planAmount,
                    date: new Date().toISOString(),
                    description: `Regular hourly earning`
                };
                database.ref(`users/${currentUser.uid}/earningsHistory`).push(logEntry);

                database.ref('users/' + currentUser.uid).update(updateData)
                .then(() => {
                })
                .catch(err => console.error("Error updating hourly earnings:", err));

            }, 3600000); 
        }


        function initTransactionButtons() {
            const depositButton = document.getElementById('submit-deposit');
            if (depositButton) depositButton.addEventListener('click', submitDepositRequest); 
            
            const withdrawButton = document.getElementById('submit-withdraw');
            if (withdrawButton) withdrawButton.addEventListener('click', submitWithdrawalRequest); 
        }

        function initDepositPage() {
            const methodCards = document.querySelectorAll('#deposit-page .method-card');
            const depositMethodNameEl = document.getElementById('deposit-method-name');
            const depositAccountLabel1El = document.getElementById('deposit-account-label1');
            const depositAccountNumberEl = document.getElementById('deposit-account-number');
            const copyDepositAddressBtn = document.getElementById('copy-deposit-address');

            const usdtAddresses = {
                usdt_bep20: '0xeb0ee64208106984101b1f127cf221358771dbfa',
                usdt_trc20: 'TKEmWeig1jtWLgPZp4pX4PHAsPsrFNdqf2'
            };

            methodCards.forEach(card => {
                card.addEventListener('click', function() {
                    methodCards.forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    
                    const method = this.dataset.method;
                    let methodNameText = '';
                    let addressLabelText = '';
                    let addressValue = '';

                    if (method === 'usdt_bep20') {
                        methodNameText = 'USDT (BEP20)';
                        addressLabelText = 'Deposit Address (BEP20):';
                        addressValue = usdtAddresses.usdt_bep20;
                    } else if (method === 'usdt_trc20') {
                        methodNameText = 'USDT (TRC20)';
                        addressLabelText = 'Deposit Address (TRC20):';
                        addressValue = usdtAddresses.usdt_trc20;
                    }
                    
                    if (depositMethodNameEl) depositMethodNameEl.textContent = methodNameText;
                    if (depositAccountLabel1El) depositAccountLabel1El.textContent = addressLabelText;
                    if (depositAccountNumberEl) depositAccountNumberEl.textContent = addressValue;
                });
            });
            
            if (copyDepositAddressBtn) {
                copyDepositAddressBtn.addEventListener('click', () => {
                    const addressToCopy = depositAccountNumberEl.textContent;
                    navigator.clipboard.writeText(addressToCopy).then(() => {
                        showNotification('Address copied to clipboard!', 'success');
                    }).catch(err => {
                        showNotification('Failed to copy address.', 'error');
                        console.error('Copy failed:', err);
                    });
                });
            }

            // Trigger click on the default active method card to initialize display
            const defaultActiveCard = document.querySelector('#deposit-page .method-card.active');
            if (defaultActiveCard) defaultActiveCard.click();
        }


        function submitDepositRequest() { 
            const amountSelect = document.getElementById('deposit-amount');
            let amount = amountSelect.value === 'other' ? 
                parseFloat(document.getElementById('custom-amount').value) : 
                parseFloat(amountSelect.value);
            
            const transactionId = document.getElementById('deposit-transaction').value.trim();
            const senderAddress = document.getElementById('deposit-sender').value.trim(); 
            const method = document.querySelector('#deposit-page .method-card.active')?.dataset.method;

            if (!amount || isNaN(amount) || amount < 5) { 
                showNotification('Invalid amount. Minimum deposit is $5.', 'error'); return;
            }
            if (!transactionId || !method) { // senderAddress is optional
                showNotification('Please fill Amount, Transaction ID, and select a Method.', 'error'); return;
            }
            
            const submitDepositBtn = document.getElementById('submit-deposit');
            showLoadingButton(submitDepositBtn, true);
            
            const depositData = {
                userId: currentUser.uid, 
                userName: userData.name, 
                amount: amount,
                method: method, // e.g., 'usdt_bep20' or 'usdt_trc20'
                transactionId: transactionId,
                senderAddress: senderAddress, // Optional
                date: new Date().toISOString(),
                status: 'pending'
            };
            
            const depositKey = database.ref(`users/${currentUser.uid}/deposits`).push().key; 
            database.ref(`users/${currentUser.uid}/deposits/${depositKey}`).set({...depositData, id: depositKey})
            .then(() => {
                database.ref(`admin/pending_deposits/${depositKey}`).set({...depositData, userUid: currentUser.uid, depositId: depositKey });

                showNotification('Deposit request submitted! Processing takes 5-30 mins.', 'success');
                const depositForm = document.querySelector('#deposit-page .deposit-form');
                if (depositForm) depositForm.reset(); // Reset the specific form
                document.getElementById('custom-amount-container').classList.add('hidden');
            })
            .catch(error => {
                showNotification(`Deposit error: ${error.message}`, 'error');
            })
            .finally(() => {
                showLoadingButton(submitDepositBtn, false, "Submit Deposit");
            });
        }

        function initWithdrawPage() {
            if (userData) {
                updateBalanceDisplay(); 
            }
        }

        function initAmountButtons() {
            const withdrawAmountInput = document.getElementById('withdraw-amount');
            document.querySelectorAll('#withdraw-page .amount-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    if(withdrawAmountInput) withdrawAmountInput.value = this.dataset.amount;
                });
            });
        }

        function submitWithdrawalRequest() { 
            const method = document.getElementById('withdraw-method').value; // e.g., 'usdt_bep20' or 'usdt_trc20'
            const account = document.getElementById('withdraw-account').value.trim(); // User's USDT address
            const name = document.getElementById('withdraw-name').value.trim(); // Optional name
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            
            if (!method || !account || !amount || isNaN(amount)) {
                showNotification('Please select method, enter your USDT address, and specify amount.', 'error'); return;
            }
             
            if (account.length < 20) { // Basic check for typical crypto address length
                 showNotification('Please enter a valid USDT wallet address.', 'error'); return;
            }
            if (amount < 2) {
                showNotification('Minimum withdrawal is $2.', 'error'); return;
            }
            if (amount > 500) {
                showNotification('Maximum withdrawal is $500.', 'error'); return;
            }
            
            const totalAvailableBalance = (userData.balance || 0) + (userData.earnings || 0);
            if (amount > totalAvailableBalance) {
                showNotification('Insufficient balance.', 'error'); return;
            }
            
            const withdrawalFeePercentage = 0.05; 
            const feeAmount = amount * withdrawalFeePercentage;
            const netAmountToReceive = amount - feeAmount; 
            const amountToDeduct = amount; 

            const withdrawalData = {
                userId: currentUser.uid,
                userName: userData.name,
                method: method, // 'usdt_bep20' or 'usdt_trc20'
                account: account, // User's USDT address
                name: name, // Optional
                requestedAmount: amount,
                fee: feeAmount,
                netAmount: netAmountToReceive,
                date: new Date().toISOString(),
                status: 'pending'
            };
            
            showConfirmationModal(
                'Confirm Withdrawal',
                `Withdraw $${amount.toFixed(2)} via ${method.toUpperCase().replace('_', ' ')} to ${account}? A 5% fee ($${feeAmount.toFixed(2)}) will apply. You will receive $${netAmountToReceive.toFixed(2)}.`,
                () => {
                    const submitWithdrawBtn = document.getElementById('submit-withdraw');
                    showLoadingButton(submitWithdrawBtn, true);
                    
                    let newEarnings = userData.earnings || 0;
                    let newBalance = userData.balance || 0;
                    
                    if (newEarnings >= amountToDeduct) {
                        newEarnings -= amountToDeduct;
                    } else {
                        const remainingToDeduct = amountToDeduct - newEarnings;
                        newEarnings = 0;
                        newBalance -= remainingToDeduct;
                    }
                    
                    const balanceUpdate = { earnings: newEarnings, balance: newBalance };
                    
                    database.ref('users/' + currentUser.uid).update(balanceUpdate)
                    .then(() => {
                        const withdrawalKey = database.ref(`users/${currentUser.uid}/withdrawals`).push().key;
                        return database.ref(`users/${currentUser.uid}/withdrawals/${withdrawalKey}`).set({...withdrawalData, id: withdrawalKey})
                            .then(() => {
                                database.ref(`admin/pending_withdrawals/${withdrawalKey}`).set({...withdrawalData, userUid: currentUser.uid, withdrawalId: withdrawalKey});
                            });
                    })
                    .then(() => {
                        showNotification('Withdrawal request submitted! Processing takes 1-6 hours.', 'success');
                        const withdrawForm = document.querySelector('#withdraw-page .withdraw-form');
                        if(withdrawForm) withdrawForm.reset();
                    })
                    .catch(error => {
                        showNotification(`Withdrawal error: ${error.message}`, 'error');
                    })
                    .finally(() => {
                        showLoadingButton(submitWithdrawBtn, false, "Request Withdrawal");
                    });
                }, 'warning' 
            );
        }

        function initCopyButton() { // For team page invite code
            const copyButton = document.getElementById('copy-invite');
            const inviteCodeInput = document.getElementById('invite-code'); 
            if (copyButton && inviteCodeInput) {
                copyButton.addEventListener('click', () => {
                    inviteCodeInput.select();
                    inviteCodeInput.setSelectionRange(0, 99999); 
                    try {
                        navigator.clipboard.writeText(inviteCodeInput.value).then(() => {
                             showNotification('Invite code copied!', 'success');
                        });
                    } catch (err) {
                        showNotification('Failed to copy code.', 'error');
                    }
                });
            }
        }

        function initShareButtons() {
            const inviteCodeEl = document.getElementById('invite-code');
            const baseAppUrl = window.location.origin + window.location.pathname; 

            document.querySelector('.share-btn.whatsapp')?.addEventListener('click', () => {
                const inviteCode = inviteCodeEl ? inviteCodeEl.value : (currentUser?.uid.slice(0,8).toUpperCase() || "DEMOCODE");
                const message = `Join Video Treasure Pro with my invite code: ${inviteCode} and earn daily! Sign up here: ${baseAppUrl}?ref=${inviteCode}`;
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            });
            
            document.querySelector('.share-btn.facebook')?.addEventListener('click', () => {
                const inviteCode = inviteCodeEl ? inviteCodeEl.value : (currentUser?.uid.slice(0,8).toUpperCase() || "DEMOCODE");
                const referralLink = `${baseAppUrl}?ref=${inviteCode}`;
                const message = `Join Video Treasure Pro with my invite code: ${inviteCode} and earn daily!`;
                window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(referralLink)}&quote=${encodeURIComponent(message)}`, '_blank');
            });
            
            document.querySelector('.share-btn.copy-link')?.addEventListener('click', () => {
                const inviteCode = inviteCodeEl ? inviteCodeEl.value : (currentUser?.uid.slice(0,8).toUpperCase() || "DEMOCODE");
                const link = `${baseAppUrl}?ref=${inviteCode}`;
                navigator.clipboard.writeText(link)
                    .then(() => showNotification('Referral link copied!', 'success'))
                    .catch(() => showNotification('Failed to copy link.', 'error'));
            });
        }

        function initRankingButton() {
            const viewRankingBtn = document.getElementById('view-ranking-btn');
            const rankingTableDiv = document.getElementById('ranking-table'); 
            if (viewRankingBtn && rankingTableDiv) {
                viewRankingBtn.addEventListener('click', () => {
                    const isHidden = rankingTableDiv.classList.contains('hidden');
                    if (isHidden) {
                        loadUserRankings(); 
                        rankingTableDiv.classList.remove('hidden');
                        viewRankingBtn.innerHTML = `<i class="fas fa-eye-slash"></i> Hide Ranking`;
                    } else {
                        rankingTableDiv.classList.add('hidden');
                        viewRankingBtn.innerHTML = `<i class="fas fa-list-ol"></i> View Full Ranking`;
                    }
                });
            }
        }

        function initTeamPage() {
            loadReferralHistory();
        }

        function loadUserRankings() {
            showLoading();
            database.ref('users').orderByChild('activePlan').limitToLast(20).once('value') 
                .then(snapshot => {
                    const rankings = [];
                    snapshot.forEach(userSnapshot => {
                        const user = userSnapshot.val();
                        if (user.name && user.activePlan && user.activePlan > 0) { 
                            rankings.push({
                                id: userSnapshot.key,
                                name: user.name,
                                investment: user.activePlan,
                                earnings: (user.earnings || 0) + (user.referralEarnings || 0) 
                            });
                        }
                    });
                    
                    rankings.sort((a, b) => b.investment - a.investment || b.earnings - a.earnings); 
                    
                    const rankingBody = document.getElementById('ranking-body');
                    if (!rankingBody) { hideLoading(); return; }
                    rankingBody.innerHTML = '';
                    
                    const top10 = rankings.slice(0, 10);
                    if (top10.length === 0) {
                        rankingBody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No active investors found.</td></tr>';
                    } else {
                        top10.forEach((user, index) => {
                            const row = document.createElement('tr');
                            if (currentUser && user.id === currentUser.uid) {
                                row.classList.add('current-user');
                            }
                            row.innerHTML = `
                                <td>${index + 1}</td>
                                <td>${user.name}</td>
                                <td>$${user.investment.toFixed(0)}</td>
                                <td>$${user.earnings.toFixed(2)}</td>
                            `;
                            rankingBody.appendChild(row);
                        });
                    }
                })
                .catch(error => {
                    showNotification('Error loading rankings: ' + error.message, 'error');
                })
                .finally(() => {
                    hideLoading();
                });
        }

        function loadDepositHistory() {
            const depositHistoryBody = document.getElementById('deposit-history-body'); 
            if (!depositHistoryBody) return;

            if (!currentUser || !userData || !userData.deposits) {
                depositHistoryBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">No deposit history.</td></tr>';
                updateDepositSummary(0, 0, 0);
                return;
            }
            
            const filterValue = document.getElementById('deposit-filter')?.value || 'all';
            const depositsArray = Object.entries(userData.deposits).map(([key, value]) => ({ ...value, id: key })); 

            let total = 0, pending = 0, completed = 0;
            depositHistoryBody.innerHTML = '';
            
            const filteredDeposits = depositsArray
                .filter(d => filterValue === 'all' || d.status === filterValue)
                .sort((a, b) => new Date(b.date) - new Date(a.date));

            if (filteredDeposits.length === 0) {
                 depositHistoryBody.innerHTML = `<tr><td colspan="5" style="text-align:center;">No deposits match '${filterValue}'.</td></tr>`;
            } else {
                filteredDeposits.forEach(deposit => {
                    if (deposit.status === 'completed') completed += deposit.amount;
                    else if (deposit.status === 'pending') pending += deposit.amount;
                    total += deposit.amount; 

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>$${deposit.amount.toFixed(2)}</td>
                        <td>${deposit.method ? deposit.method.toUpperCase().replace('_', ' ') : 'N/A'}</td>
                        <td>${formatDate(deposit.date)}</td>
                        <td class="status-${deposit.status}">${deposit.status}</td>
                        <td>
                            ${deposit.status === 'pending' ? 
                                `<span class="action-link" data-id="${deposit.id}" data-type="deposit">Cancel</span>` : 
                                '--'}
                        </td>
                    `;
                    depositHistoryBody.appendChild(row);
                });
            }
            let summaryTotal = 0, summaryPending = 0, summaryCompleted = 0;
            depositsArray.forEach(d => {
                summaryTotal += d.amount;
                if (d.status === 'completed') summaryCompleted += d.amount;
                if (d.status === 'pending') summaryPending += d.amount;
            });
            updateDepositSummary(summaryTotal, summaryPending, summaryCompleted);
            
            attachCancelListeners(depositHistoryBody, 'deposit');
        }


        function updateDepositSummary(total, pending, completed) {
            document.getElementById('total-deposits').textContent = `$${total.toFixed(2)}`;
            document.getElementById('pending-deposits').textContent = `$${pending.toFixed(2)}`;
            document.getElementById('completed-deposits').textContent = `$${completed.toFixed(2)}`;
        }

        function loadWithdrawHistory() {
            const withdrawHistoryBody = document.getElementById('withdraw-history-body'); 
             if (!withdrawHistoryBody) return;

            if (!currentUser || !userData || !userData.withdrawals) {
                withdrawHistoryBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">No withdrawal history.</td></tr>';
                updateWithdrawalSummary(0, 0, 0);
                return;
            }

            const filterValue = document.getElementById('withdraw-filter')?.value || 'all';
            const withdrawalsArray = Object.entries(userData.withdrawals).map(([key, value]) => ({ ...value, id: key }));

            let total = 0, pending = 0, completed = 0;
            withdrawHistoryBody.innerHTML = '';

            const filteredWithdrawals = withdrawalsArray
                .filter(w => filterValue === 'all' || w.status === filterValue)
                .sort((a, b) => new Date(b.date) - new Date(a.date));

            if (filteredWithdrawals.length === 0) {
                 withdrawHistoryBody.innerHTML = `<tr><td colspan="5" style="text-align:center;">No withdrawals match '${filterValue}'.</td></tr>`;
            } else {
                filteredWithdrawals.forEach(withdrawal => {
                    if (withdrawal.status === 'completed') completed += withdrawal.requestedAmount;
                    else if (withdrawal.status === 'pending') pending += withdrawal.requestedAmount;
                    total += withdrawal.requestedAmount;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>$${withdrawal.requestedAmount.toFixed(2)}</td>
                        <td>${withdrawal.method ? withdrawal.method.toUpperCase().replace('_', ' ') : 'N/A'}</td>
                        <td>${formatDate(withdrawal.date)}</td>
                        <td class="status-${withdrawal.status}">${withdrawal.status}</td>
                        <td>
                            ${withdrawal.status === 'pending' ? 
                                `<span class="action-link" data-id="${withdrawal.id}" data-type="withdrawal" data-amount="${withdrawal.requestedAmount}">Cancel</span>` :
                                '--'}
                        </td>
                    `;
                    withdrawHistoryBody.appendChild(row);
                });
            }
            let summaryTotal = 0, summaryPending = 0, summaryCompleted = 0;
            withdrawalsArray.forEach(w => {
                summaryTotal += w.requestedAmount;
                if (w.status === 'completed') summaryCompleted += w.requestedAmount;
                if (w.status === 'pending') summaryPending += w.requestedAmount;
            });
            updateWithdrawalSummary(summaryTotal, summaryPending, summaryCompleted);
            
            attachCancelListeners(withdrawHistoryBody, 'withdrawal');
        }

        function updateWithdrawalSummary(total, pending, completed) {
            document.getElementById('total-withdrawals').textContent = `$${total.toFixed(2)}`;
            document.getElementById('pending-withdrawals').textContent = `$${pending.toFixed(2)}`;
            document.getElementById('completed-withdrawals').textContent = `$${completed.toFixed(2)}`;
        }

        function attachCancelListeners(tableBody, type) {
            tableBody.querySelectorAll('.action-link').forEach(link => {
                link.addEventListener('click', function() {
                    const id = this.dataset.id;
                    const amount = parseFloat(this.dataset.amount); 
                    if (type === 'deposit') cancelTransaction(id, 'deposit', 0);
                    else if (type === 'withdrawal') cancelTransaction(id, 'withdrawal', amount);
                });
            });
        }

        function cancelTransaction(id, type, amountToRefund = 0) {
            const capitalizedType = type.charAt(0).toUpperCase() + type.slice(1);
            showConfirmationModal(
                `Cancel ${capitalizedType}`,
                `Are you sure you want to cancel this ${type} request? ${type === 'withdrawal' ? 'The amount will be refunded to your balance.' : ''}`,
                () => {
                    showLoading();
                    const path = `users/${currentUser.uid}/${type}s/${id}`; 
                    const adminPath = `admin/pending_${type}s/${id}`; 
                    
                    database.ref(path).update({ status: 'cancelled' })
                    .then(() => {
                        return database.ref(adminPath).update({ status: 'cancelled_by_user' }); 
                    })
                    .then(() => {
                        if (type === 'withdrawal' && amountToRefund > 0) {
                            let newEarnings = userData.earnings || 0;
                            let newBalance = userData.balance || 0;
                            
                            newEarnings += amountToRefund;

                            return database.ref(`users/${currentUser.uid}`).update({ earnings: newEarnings });
                        }
                        return Promise.resolve();
                    })
                    .then(() => {
                        showNotification(`${capitalizedType} request cancelled.`, 'success');
                        if(type === 'deposit') loadDepositHistory();
                        if(type === 'withdrawal') loadWithdrawHistory();
                    })
                    .catch(error => {
                        showNotification(`Error cancelling ${type}: ${error.message}`, 'error');
                    })
                    .finally(() => {
                        hideLoading();
                    });
                }, 'warning'
            );
        }


        function loadReferralHistory() {
            const referralTableBody = document.getElementById('referral-body'); 
            if (!referralTableBody) return;

            if (!currentUser || !userData || !userData.referralHistory) {
                referralTableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">No referral history.</td></tr>';
                return;
            }
            
            const referralsArray = Object.values(userData.referralHistory)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            referralTableBody.innerHTML = '';
            if (referralsArray.length === 0) {
                 referralTableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">No referrals yet.</td></tr>';
            } else {
                referralsArray.forEach(referral => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${referral.name || 'Referred User'}</td>
                        <td>${referral.plan ? getPlanName(referral.plan) + ` ($${referral.plan})` : 'N/A'}</td>
                        <td>$${(referral.amount || 0).toFixed(2)}</td>
                        <td>${formatDate(referral.date)}</td>
                        <td class="status-${referral.status || 'completed'}">${referral.status || 'Completed'}</td>
                    `;
                    referralTableBody.appendChild(row);
                });
            }
        }


        function initEarningsPage() {
            loadEarningsHistory(); 
            setupEarningsChart(); 
        }

        function loadEarningsHistory() {
            const earningsTableBody = document.getElementById('earnings-body'); 
            if (!earningsTableBody) return;

            if (!currentUser || !userData) {
                earningsTableBody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No earnings history.</td></tr>';
                updateEarningsSummary(0, 0, 0);
                if (earningsChartInstance) updateChartData([], 'all');
                return;
            }
            
            const periodFilter = document.getElementById('earnings-period')?.value || 'all';
            const allEarningsEntries = [];

            if (userData.earningsHistory) { 
                Object.values(userData.earningsHistory).forEach(entry => {
                    allEarningsEntries.push({
                        date: entry.date,
                        type: 'Investment',
                        amount: entry.amount,
                        description: `From ${entry.plan ? getPlanName(entry.plan) : 'Active Plan'}`
                    });
                });
            }
            if (userData.referralHistory) { 
                Object.values(userData.referralHistory).forEach(entry => {
                     if (entry.status === 'completed' || !entry.status) { // Only count completed referral earnings
                        allEarningsEntries.push({
                            date: entry.date,
                            type: 'Referral',
                            amount: entry.amount,
                            description: `From ${entry.name || 'Referral'}`
                        });
                    }
                });
            }

            allEarningsEntries.sort((a, b) => new Date(b.date) - new Date(a.date));

            const now = new Date();
            const filteredForPeriod = allEarningsEntries.filter(e => {
                const entryDate = new Date(e.date);
                if (periodFilter === 'today') return entryDate.toDateString() === now.toDateString();
                if (periodFilter === 'week') {
                    const weekStart = new Date(now);
                    weekStart.setDate(now.getDate() - now.getDay());
                    weekStart.setHours(0,0,0,0);
                    return entryDate >= weekStart;
                }
                if (periodFilter === 'month') return entryDate.getMonth() === now.getMonth() && entryDate.getFullYear() === now.getFullYear();
                return true; 
            });

            let totalAllTimeCalc = 0, todayTotal = 0, totalReferral = 0;
            allEarningsEntries.forEach(e => { 
                totalAllTimeCalc += e.amount;
                if (e.type === 'Referral') totalReferral += e.amount;
                if (new Date(e.date).toDateString() === new Date().toDateString()) todayTotal += e.amount;
            });


            updateEarningsSummary(
                totalAllTimeCalc, 
                todayTotal,
                totalReferral
            );
            
            earningsTableBody.innerHTML = '';
            if (filteredForPeriod.length === 0) {
                earningsTableBody.innerHTML = `<tr><td colspan="4" style="text-align:center;">No earnings for this period.</td></tr>`;
            } else {
                filteredForPeriod.slice(0, 20).forEach(earning => { 
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${formatDate(earning.date)}</td>
                        <td><span class="badge ${earning.type.toLowerCase()}">${earning.type}</span></td>
                        <td>$${earning.amount.toFixed(2)}</td>
                        <td>${earning.description}</td>
                    `;
                    earningsTableBody.appendChild(row);
                });
            }
             updateChartData(filteredForPeriod, periodFilter); 
        }
        
        function updateEarningsSummary(totalAllTime, today, referralTotal) {
            document.getElementById('total-earnings').textContent = `$${totalAllTime.toFixed(2)}`;
            document.getElementById('today-earnings').textContent = `$${today.toFixed(2)}`;
            document.getElementById('all-referral-earnings').textContent = `$${referralTotal.toFixed(2)}`;
        }

        function setupEarningsChart() { 
            const ctx = document.getElementById('earnings-chart')?.getContext('2d');
            if (!ctx) return;

            if (earningsChartInstance) {
                earningsChartInstance.destroy(); 
            }
            
            earningsChartInstance = new Chart(ctx, {
                type: 'line', 
                data: {
                    labels: [], 
                    datasets: [
                        {
                            label: 'Total Earnings',
                            data: [], 
                            borderColor: 'var(--primary-color)',
                            backgroundColor: 'rgba(106, 27, 154, 0.1)',
                            fill: true,
                            tension: 0.3
                        },
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Amount (USD)' }},
                        x: { title: { display: true, text: 'Date/Time Period' }}
                    },
                    plugins: { legend: { display: true }, title: { display: true, text: 'Earnings Trend' }}
                }
            });
        }

        function updateChartData(earningsData, period) {
            if (!earningsChartInstance) return;

            let labels = [];
            let dataPoints = [];

            if (period === 'today' || (period === 'all' && earningsData.length > 30)) { 
                // For 'today' or very long 'all time' data, show individual entries (last 15 for 'all')
                const recentEarnings = (period === 'all' ? earningsData.slice(0, 15) : earningsData).reverse();
                labels = recentEarnings.map(e => formatDate(e.date, true)); 
                dataPoints = recentEarnings.map(e => e.amount);
            } else { 
                 // Aggregate by day for 'week', 'month', or shorter 'all time'
                const dailyTotals = {};
                earningsData.forEach(e => {
                    const day = new Date(e.date).toLocaleDateString('en-CA'); // YYYY-MM-DD for sorting
                    dailyTotals[day] = (dailyTotals[day] || 0) + e.amount;
                });
                labels = Object.keys(dailyTotals).sort((a,b) => new Date(a) - new Date(b))
                               .map(dateStr => formatDate(dateStr, true)); // Format for display
                dataPoints = Object.keys(dailyTotals).sort((a,b) => new Date(a) - new Date(b))
                                 .map(day => dailyTotals[day]);
            }
            
            earningsChartInstance.data.labels = labels;
            earningsChartInstance.data.datasets[0].data = dataPoints;
            earningsChartInstance.update();
        }


        function initHistoryFilters() {
            document.getElementById('deposit-filter')?.addEventListener('change', loadDepositHistory);
            document.getElementById('withdraw-filter')?.addEventListener('change', loadWithdrawHistory);
            document.getElementById('earnings-period')?.addEventListener('change', loadEarningsHistory);
        }

        function initContactForm() {
            const contactFormEl = document.getElementById('contact-form'); 
            if (contactFormEl) {
                contactFormEl.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('contact-name').value.trim();
                    const email = document.getElementById('contact-email').value.trim();
                    const subject = document.getElementById('contact-subject').value.trim();
                    const message = document.getElementById('contact-message').value.trim();
                    
                    if (!name || !email || !subject || !message || !validateEmail(email)) {
                        showNotification('Please fill all fields correctly.', 'error'); return;
                    }
                    
                    const submitBtn = this.querySelector('.submit-btn');
                    showLoadingButton(submitBtn, true);
                    
                    const messageData = { name, email, subject, message, date: new Date().toISOString(), userId: currentUser ? currentUser.uid : 'guest' };
                    database.ref('contact_messages').push(messageData)
                    .then(() => {
                        showNotification('Message sent! We will respond soon.', 'success');
                        contactFormEl.reset();
                    })
                    .catch(err => {
                        showNotification('Failed to send message. Try again.', 'error');
                        console.error("Contact form error: ", err);
                    })
                    .finally(() => {
                        showLoadingButton(submitBtn, false, "Send Message");
                    });
                });
            }
        }

        function showConfirmationModal(title, message, confirmCallback, type = 'warning') {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').innerHTML = message; // Use innerHTML for potential formatting
            
            const modalIconContainer = confirmationModal.querySelector('.modal-icon'); 
            modalIconContainer.querySelectorAll('i').forEach(icon => icon.style.display = 'none');
            const iconToShow = modalIconContainer.querySelector(`i.${type}`);
            if(iconToShow) iconToShow.style.display = 'block';
            
            confirmationModal.classList.add('active');
            confirmationModal.classList.remove('hidden');
            
            const confirmBtn = document.getElementById('modal-confirm');
            // Re-clone to remove old listeners and add new one
            const newConfirmBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            
            newConfirmBtn.onclick = () => {
                confirmationModal.classList.remove('active');
                confirmationModal.classList.add('hidden');
                if (typeof confirmCallback === 'function') confirmCallback();
            };
            // Ensure cancel button also clears and hides
             modalCancel.onclick = () => {
                confirmationModal.classList.remove('active');
                confirmationModal.classList.add('hidden');
            };
        }

        function formatDate(dateString, short = false) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            if (short) {
                 return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            }
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', month: 'short', day: 'numeric',
                hour: '2-digit', minute: '2-digit', hour12: true
            });
        }

        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
